---
title: Templates Twig
description: Personnaliser l'affichage avec le moteur de templates Twig
sidebar:
  order: 2

# status: stable
# last-reviewed: 2026-01-14
---

import { Tabs, TabItem, Aside, Steps } from '@astrojs/starlight/components';

## üåø Qu'est-ce que Twig ?

**Twig** est le moteur de templates utilis√© par Drupal depuis la version 8. C'est un langage de templating moderne, s√ªr et flexible qui s√©pare la logique m√©tier (PHP) de la pr√©sentation (HTML).

### Pourquoi Twig dans Drupal ?

**Avant Drupal 8** : PHPTemplate (m√©lange PHP/HTML difficile √† maintenir)
**Depuis Drupal 8** : Twig (s√©paration claire, s√©curit√© renforc√©e)

### Avantages de Twig

- ‚úÖ **S√©curit√©** : √âchappement automatique contre les attaques XSS
- ‚úÖ **Syntaxe claire** : Facile √† lire et √† maintenir
- ‚úÖ **H√©ritage** : R√©utilisation et extension de templates
- ‚úÖ **Filtres puissants** : Transformation de donn√©es sans PHP
- ‚úÖ **S√©paration** : Logique m√©tier (PHP) vs pr√©sentation (Twig)
- ‚úÖ **Performance** : Templates compil√©s en PHP optimis√©

### Twig vs PHP dans les templates

| Aspect | PHPTemplate (ancien) | Twig (actuel) |
|--------|----------------------|---------------|
| S√©curit√© | √âchappement manuel | Automatique |
| Syntaxe | `<?php echo $var ?>` | `{{ var }}` |
| Logique | PHP m√©lang√© au HTML | S√©par√© en .theme |
| Maintenabilit√© | Difficile | Excellente |
| Courbe d'apprentissage | Connaissance PHP | Syntaxe simple |

### Syntaxe de base

```twig
{# Commentaire - ignor√© dans le rendu #}

{{ variable }}                    {# Affiche une variable #}
{{ variable|filter }}             {# Applique un filtre #}

{% if condition %}                {# Structure de contr√¥le #}
{% endif %}

{% for item in items %}           {# Boucle #}
{% endfor %}
```

## üîç Activer le d√©bogage Twig

<Steps>

1. Copiez le fichier de services par d√©faut

    ```bash
    cp sites/default/default.services.yml sites/default/services.yml
    ```

2. √âditez `sites/default/services.yml`

    ```yaml
    parameters:
      twig.config:
        debug: true
        auto_reload: true
        cache: false
    ```

3. Videz le cache

    ```bash
    drush cr
    ```

</Steps>

<Aside type="tip" title="Raccourci pour d√©veloppeurs">
Si le fichier `services.yml` n'existe pas encore, vous pouvez le cr√©er directement avec les bonnes valeurs :

```bash
cat > sites/default/services.yml << 'EOF'
parameters:
  twig.config:
    debug: true
    auto_reload: true
    cache: false
EOF

drush cr
```
</Aside>

### R√©sultat dans le HTML source

```html
<!-- THEME DEBUG -->
<!-- THEME HOOK: 'node' -->
<!-- FILE NAME SUGGESTIONS:
   * node--product--full.html.twig
   * node--product.html.twig
   * node--1.html.twig
   * node.html.twig
-->
<!-- BEGIN OUTPUT from 'core/themes/olivero/templates/content/node.html.twig' -->
```

<Aside type="caution" title="Production">
D√©sactivez le d√©bogage Twig en production pour les performances !
</Aside>

## üìê Hi√©rarchie des templates

### Template de base ‚Üí Plus sp√©cifique

```
node.html.twig                    # Template g√©n√©rique
  ‚îî‚îÄ‚îÄ node--article.html.twig     # Type de contenu sp√©cifique
      ‚îî‚îÄ‚îÄ node--article--teaser.html.twig  # + View mode
          ‚îî‚îÄ‚îÄ node--123.html.twig  # N≈ìud sp√©cifique
```

### Priorit√© (du plus au moins sp√©cifique)

1. `node--{id}.html.twig` ‚Üí `node--123.html.twig`
2. `node--{type}--{view-mode}.html.twig` ‚Üí `node--product--card.html.twig`
3. `node--{type}.html.twig` ‚Üí `node--product.html.twig`
4. `node--{view-mode}.html.twig` ‚Üí `node--teaser.html.twig`
5. `node.html.twig` ‚Üí Template de base

## üìÑ Templates principaux

### page.html.twig

Structure globale de la page :

```twig
{#
/**
 * @file
 * Theme override for the page template.
 */
#}
<!DOCTYPE html>
<html{{ html_attributes }}>
<head>
  <head-placeholder token="{{ placeholder_token }}">
  <title>{{ head_title|safe_join(' | ') }}</title>
  <css-placeholder token="{{ placeholder_token }}">
  <js-placeholder token="{{ placeholder_token }}">
</head>
<body{{ attributes }}>
  <a href="#main-content" class="visually-hidden focusable skip-link">
    {{ 'Skip to main content'|t }}
  </a>
  
  {{ page_top }}
  {{ page }}
  {{ page_bottom }}
  
  <js-bottom-placeholder token="{{ placeholder_token }}">
</body>
</html>
```

### Fichier page.html.twig personnalis√©

```twig
{#
/**
 * @file
 * TailStore theme override for the page template.
 */
#}
<div class="layout-container">
  
  <header class="site-header" role="banner">
    <div class="header-inner container">
      {{ page.header }}
      
      <nav class="main-nav" role="navigation">
        {{ page.primary_menu }}
      </nav>
      
      <div class="header-actions">
        {{ page.secondary_menu }}
      </div>
    </div>
  </header>

  {% if page.highlighted %}
    <div class="highlighted">
      {{ page.highlighted }}
    </div>
  {% endif %}

  {% if page.breadcrumb %}
    <nav class="breadcrumb-nav" aria-label="Breadcrumb">
      <div class="container">
        {{ page.breadcrumb }}
      </div>
    </nav>
  {% endif %}

  <main role="main" id="main-content" class="site-main">
    <div class="container">
      
      {{ page.help }}

      <div class="main-content-wrapper{% if page.sidebar %} has-sidebar{% endif %}">
        <div class="content-area">
          {{ page.content }}
        </div>

        {% if page.sidebar %}
          <aside class="sidebar" role="complementary">
            {{ page.sidebar }}
          </aside>
        {% endif %}
      </div>

      {% if page.content_below %}
        <div class="content-below">
          {{ page.content_below }}
        </div>
      {% endif %}
      
    </div>
  </main>

  <footer class="site-footer" role="contentinfo">
    <div class="container">
      {% if page.footer_top %}
        <div class="footer-top">
          {{ page.footer_top }}
        </div>
      {% endif %}
      
      {% if page.footer_bottom %}
        <div class="footer-bottom">
          {{ page.footer_bottom }}
        </div>
      {% endif %}
    </div>
  </footer>

</div>
```

## üõçÔ∏è Template node--product.html.twig

```twig
{#
/**
 * @file
 * Theme override for Product full display.
 *
 * Available variables:
 * - node: The node entity.
 * - label: The node title.
 * - content: All node items.
 * - formatted_price: Prix format√© (depuis preprocess).
 * - in_stock: Bool√©en de disponibilit√©.
 * - is_on_sale: Produit en promotion.
 * - old_price: Ancien prix si promo.
 */
#}

{% set classes = [
  'node',
  'node--type-' ~ node.bundle|clean_class,
  node.isPromoted() ? 'node--promoted',
  node.isSticky() ? 'node--sticky',
  not node.isPublished() ? 'node--unpublished',
  view_mode ? 'node--view-mode-' ~ view_mode|clean_class,
  'product',
  'product--full',
] %}

<article{{ attributes.addClass(classes) }}>
  
  <div class="product__gallery">
    {% if content.field_images|render %}
      <div class="product__main-image">
        {{ content.field_images.0 }}
      </div>
      
      {% if content.field_images|length > 1 %}
        <div class="product__thumbnails">
          {% for key, image in content.field_images if key matches '/^\\d+$/' %}
            <button class="product__thumbnail" data-index="{{ key }}">
              {{ image }}
            </button>
          {% endfor %}
        </div>
      {% endif %}
    {% endif %}
  </div>

  <div class="product__details">
    
    {# Marque #}
    {% if content.field_brand|render %}
      <div class="product__brand">
        {{ content.field_brand }}
      </div>
    {% endif %}
    
    {# Titre #}
    {{ title_prefix }}
    <h1 class="product__title">{{ label }}</h1>
    {{ title_suffix }}
    
    {# Prix #}
    <div class="product__pricing">
      {% if is_on_sale and old_price %}
        <span class="product__old-price">{{ old_price }}</span>
        <span class="product__price product__price--sale">{{ formatted_price }}</span>
        <span class="product__discount-badge">Promo</span>
      {% else %}
        <span class="product__price">{{ formatted_price }}</span>
      {% endif %}
    </div>
    
    {# Disponibilit√© #}
    <div class="product__availability">
      {% if in_stock %}
        <span class="badge badge--success">En stock</span>
      {% else %}
        <span class="badge badge--danger">Rupture de stock</span>
      {% endif %}
    </div>
    
    {# Description courte #}
    {% if content.field_short_description|render %}
      <div class="product__short-description">
        {{ content.field_short_description }}
      </div>
    {% endif %}
    
    {# Tailles #}
    {% if content.field_sizes|render %}
      <div class="product__sizes">
        <label class="product__option-label">Taille :</label>
        <div class="product__size-options">
          {% for size in node.field_sizes %}
            <button class="size-btn" type="button" data-size="{{ size.entity.id }}">
              {{ size.entity.label }}
            </button>
          {% endfor %}
        </div>
      </div>
    {% endif %}
    
    {# Couleurs #}
    {% if content.field_colors|render %}
      <div class="product__colors">
        <label class="product__option-label">Couleur :</label>
        <div class="product__color-options">
          {% for color in node.field_colors %}
            <button 
              class="color-btn" 
              type="button"
              data-color="{{ color.entity.id }}"
              style="background-color: {{ color.entity.field_color_code.value }}"
              title="{{ color.entity.label }}"
            ></button>
          {% endfor %}
        </div>
      </div>
    {% endif %}
    
    {# Actions #}
    <div class="product__actions">
      <div class="product__quantity">
        <label for="quantity">Quantit√© :</label>
        <input type="number" id="quantity" name="quantity" value="1" min="1" max="10">
      </div>
      
      <button 
        type="button" 
        class="btn btn--primary btn--lg product__add-to-cart"
        data-product-id="{{ node.id }}"
        {% if not in_stock %}disabled{% endif %}
      >
        <span class="btn__icon">üõí</span>
        <span class="btn__text">Ajouter au panier</span>
      </button>
      
      <button type="button" class="btn btn--outline product__wishlist">
        ‚ô° Favoris
      </button>
    </div>
    
    {# SKU #}
    {% if content.field_sku|render %}
      <div class="product__sku">
        <strong>R√©f√©rence :</strong> {{ content.field_sku }}
      </div>
    {% endif %}
    
    {# Cat√©gorie #}
    {% if content.field_category|render %}
      <div class="product__category">
        <strong>Cat√©gorie :</strong> {{ content.field_category }}
      </div>
    {% endif %}
    
  </div>
  
  {# Description compl√®te #}
  {% if content.field_description|render %}
    <div class="product__full-description">
      <h2>Description</h2>
      {{ content.field_description }}
    </div>
  {% endif %}

</article>
```

## üÉè Template node--product--card.html.twig

```twig
{#
/**
 * @file
 * Theme override for Product card display.
 */
#}

{% set classes = [
  'product-card',
  is_on_sale ? 'product-card--sale',
  not in_stock ? 'product-card--out-of-stock',
] %}

<article{{ attributes.addClass(classes) }}>
  
  {# Badges #}
  <div class="product-card__badges">
    {% if is_on_sale %}
      <span class="badge badge--danger">-{{ discount_percent }}%</span>
    {% endif %}
    {% if node.isPromoted() %}
      <span class="badge badge--primary">Nouveau</span>
    {% endif %}
  </div>
  
  {# Image #}
  <a href="{{ url }}" class="product-card__image-link">
    {% if content.field_images.0 %}
      {{ content.field_images.0 }}
    {% else %}
      <img src="/themes/custom/tailstore/images/placeholder.jpg" alt="Image non disponible">
    {% endif %}
  </a>
  
  {# Actions rapides #}
  <div class="product-card__quick-actions">
    <button class="quick-action quick-action--wishlist" title="Ajouter aux favoris">
      ‚ô°
    </button>
    <button class="quick-action quick-action--view" title="Aper√ßu rapide">
      üëÅ
    </button>
  </div>
  
  <div class="product-card__info">
    
    {# Marque #}
    {% if node.field_brand.entity %}
      <span class="product-card__brand">
        {{ node.field_brand.entity.label }}
      </span>
    {% endif %}
    
    {# Titre #}
    <h3 class="product-card__title">
      <a href="{{ url }}">{{ label }}</a>
    </h3>
    
    {# Prix #}
    <div class="product-card__price">
      {% if is_on_sale and old_price %}
        <span class="price--old">{{ old_price }}</span>
        <span class="price--current price--sale">{{ formatted_price }}</span>
      {% else %}
        <span class="price--current">{{ formatted_price }}</span>
      {% endif %}
    </div>
    
    {# Couleurs disponibles #}
    {% if node.field_colors|length > 0 %}
      <div class="product-card__colors">
        {% for color in node.field_colors|slice(0, 4) %}
          <span 
            class="color-dot" 
            style="background-color: {{ color.entity.field_color_code.value }}"
            title="{{ color.entity.label }}"
          ></span>
        {% endfor %}
        {% if node.field_colors|length > 4 %}
          <span class="color-more">+{{ node.field_colors|length - 4 }}</span>
        {% endif %}
      </div>
    {% endif %}
    
  </div>
  
  {# Bouton ajout panier #}
  <button 
    class="product-card__add-to-cart btn btn--primary btn--full"
    data-product-id="{{ node.id }}"
    {% if not in_stock %}disabled{% endif %}
  >
    {% if in_stock %}
      Ajouter au panier
    {% else %}
      Indisponible
    {% endif %}
  </button>

</article>
```

## üîß Filtres Twig utiles

| Filtre | Description | Exemple |
|--------|-------------|---------|
| `\|t` | Traduction | `{{ 'Hello'\|t }}` |
| `\|raw` | HTML non √©chapp√© | `{{ html_content\|raw }}` |
| `\|escape` | √âchapper le HTML | `{{ user_input\|escape }}` |
| `\|length` | Longueur | `{{ items\|length }}` |
| `\|first` / `\|last` | Premier/dernier | `{{ items\|first }}` |
| `\|slice(0, 5)` | Sous-ensemble | `{{ items\|slice(0, 5) }}` |
| `\|join(', ')` | Concat√©ner | `{{ tags\|join(', ') }}` |
| `\|default('N/A')` | Valeur par d√©faut | `{{ value\|default('N/A') }}` |
| `\|clean_class` | Classe CSS valide | `{{ type\|clean_class }}` |
| `\|without('field_x')` | Exclure un champ | `{{ content\|without('field_images') }}` |
| `\|render` | Rendre un √©l√©ment | `{% if content.field_x\|render %}` |
| `\|number_format` | Formater un nombre | `{{ price\|number_format(2, ',', ' ') }}` |

## üîÑ Fonctions Twig Drupal

| Fonction | Description | Exemple |
|----------|-------------|---------|
| `url(route)` | G√©n√©rer une URL | `{{ url('entity.node.canonical', {'node': node.id}) }}` |
| `path(route)` | Chemin sans domaine | `{{ path('user.page') }}` |
| `link(text, url)` | Cr√©er un lien | `{{ link('Cliquez', url) }}` |
| `file_url(uri)` | URL d'un fichier | `{{ file_url(node.field_image.entity.fileuri) }}` |
| `attach_library()` | Charger une librairie | `{{ attach_library('tailstore/slider') }}` |
| `create_attribute()` | Cr√©er des attributs | `{% set attr = create_attribute() %}` |

## üéØ Exercices pratiques

### Exercice 1 : Cr√©er un template page personnalis√©

**Objectif** : Surcharger le template de page pour ajouter une structure HTML personnalis√©e.

<Steps>

1. Localisez le template de base :
   ```bash
   # Trouver le template page.html.twig du th√®me de base
   find web/core/themes -name "page.html.twig"
   ```

2. Copiez-le dans votre th√®me :
   ```bash
   mkdir -p themes/custom/tailstore/templates/layout
   cp web/core/themes/olivero/templates/layout/page.html.twig \
      themes/custom/tailstore/templates/layout/page.html.twig
   ```

3. Modifiez le template pour ajouter une classe personnalis√©e :
   ```twig
   <div class="layout-container tailstore-layout">
     {# Votre structure personnalis√©e #}
   </div>
   ```

4. Videz le cache :
   ```bash
   drush cr
   ```

5. Inspectez le HTML (F12) : la classe `tailstore-layout` doit appara√Ætre

</Steps>

**Validation** : ‚úÖ La classe personnalis√©e est visible dans l'inspecteur

---

### Exercice 2 : Cr√©er un template de produit simple

**Objectif** : Cr√©er un template basique pour afficher un produit avec titre et prix.

<Steps>

1. Cr√©ez le fichier :
   ```bash
   touch themes/custom/tailstore/templates/node/node--product.html.twig
   ```

2. Ajoutez ce code minimal :
   ```twig
   <article class="product">
     <h2>{{ label }}</h2>
     
     {% if content.field_price|render %}
       <div class="price">
         {{ content.field_price }}
       </div>
     {% endif %}
     
     {{ content|without('field_price') }}
   </article>
   ```

3. Videz le cache et visitez une page produit

</Steps>

**Validation** : ‚úÖ Le produit s'affiche avec le nouveau template

---

### Exercice 3 : Utiliser les filtres Twig

**Objectif** : Manipuler des donn√©es avec les filtres Twig.

**T√¢ches** :

1. **Limiter la description** :
   ```twig
   {# Afficher seulement les 100 premiers caract√®res #}
   {{ content.field_description|render|striptags|slice(0, 100) }}...
   ```

2. **Formater un prix** :
   ```twig
   {# Dans tailstore.theme, pr√©parez formatted_price #}
   {# Puis dans le template : #}
   <span class="price">{{ formatted_price }}</span>
   ```

3. **Afficher une liste de cat√©gories** :
   ```twig
   {% if node.field_categories %}
     <div class="categories">
       {% for category in node.field_categories %}
         <span class="badge">{{ category.entity.label }}</span>
       {% endfor %}
     </div>
   {% endif %}
   ```

**Validation** : ‚úÖ Les filtres fonctionnent et transforment les donn√©es correctement

---

### Exercice 4 : Ajouter des conditions

**Objectif** : Afficher du contenu conditionnel selon le contexte.

```twig
{# Badge "Nouveau" si publi√© il y a moins de 7 jours #}
{% set created_date = node.getCreatedTime() %}
{% set current_date = "now"|date('U') %}
{% set days_old = (current_date - created_date) / 86400 %}

{% if days_old < 7 %}
  <span class="badge badge--new">Nouveau</span>
{% endif %}

{# Badge "Promo" si prix barr√© existe #}
{% if content.field_old_price|render %}
  <span class="badge badge--sale">Promo</span>
{% endif %}

{# Afficher stock #}
{% if in_stock %}
  <span class="stock stock--available">En stock</span>
{% else %}
  <span class="stock stock--unavailable">Rupture de stock</span>
{% endif %}
```

**Validation** : ‚úÖ Les badges s'affichent selon les conditions

## üß† Bonnes pratiques essentielles

### üîí S√©curit√© Twig

**√âchappement automatique**

Twig √©chappe automatiquement toutes les variables pour pr√©venir les attaques XSS.

```twig
{# ‚úÖ S√©curis√© par d√©faut #}
{{ user_input }}  {# √âchappe automatiquement < > " ' & #}

{# ‚ö†Ô∏è Dangereux - √Ä √©viter #}
{{ user_input|raw }}  {# Pas d'√©chappement, risque XSS #}

{# ‚úÖ Si vous devez afficher du HTML, utilisez les fonctions Drupal #}
{{ content.field_body }}  {# Drupal g√®re l'√©chappement intelligent #}
```

<Aside type="caution" title="R√®gle d'or">
Ne JAMAIS utiliser `|raw` sur des donn√©es utilisateur. Seulement sur du contenu provenant de champs Drupal s√©curis√©s ou de variables pr√©process√©es.
</Aside>

### ‚ö° Performance

**V√©rifier l'existence avant le rendu**

```twig
{# ‚ùå Mauvais - Rend m√™me si vide, g√©n√®re du HTML inutile #}
{% if content.field_images %}
  {{ content.field_images }}
{% endif %}

{# ‚úÖ Bon - V√©rifie vraiment si le champ a du contenu #}
{% if content.field_images|render %}
  {{ content.field_images }}
{% endif %}

{# ‚úÖ Encore mieux - V√©rifie en PHP (preprocessing) #}
{% if has_images %}
  {{ content.field_images }}
{% endif %}
```

**Limiter les boucles**

```twig
{# ‚ùå Mauvais - Affiche potentiellement des milliers d'items #}
{% for item in items %}
  {{ item }}
{% endfor %}

{# ‚úÖ Bon - Limite √† 10 items #}
{% for item in items|slice(0, 10) %}
  {{ item }}
{% endfor %}
```

### ‚ôø Accessibilit√©

**Landmarks HTML5 et ARIA**

```twig
{# ‚úÖ Utiliser les balises s√©mantiques HTML5 #}
<header role="banner">
  {{ page.header }}
</header>

<nav role="navigation" aria-label="{{ 'Navigation principale'|t }}">
  {{ page.primary_menu }}
</nav>

<main role="main" id="main-content" tabindex="-1">
  <a id="main-content"></a>
  {{ page.content }}
</main>

<aside role="complementary" aria-label="{{ 'Filtres'|t }}">
  {{ page.sidebar }}
</aside>

<footer role="contentinfo">
  {{ page.footer }}
</footer>
```

**Skip link obligatoire**

```twig
<a href="#main-content" class="visually-hidden focusable skip-link">
  {{ 'Aller au contenu principal'|t }}
</a>
```

**Images accessibles**

```twig
{# ‚ùå Mauvais - Pas d'attribut alt #}
<img src="{{ image_url }}">

{# ‚úÖ Bon - Alt descriptif #}
<img src="{{ image_url }}" alt="{{ node.label }}">

{# ‚úÖ Image d√©corative #}
<img src="{{ icon_url }}" alt="" role="presentation">
```

### üìã Conventions de nommage

1. **Classes CSS** : Utilisez BEM ou une convention coh√©rente
   ```twig
   <div class="product-card">
     <h3 class="product-card__title">{{ label }}</h3>
     <div class="product-card__price">{{ price }}</div>
   </div>
   ```

2. **Variables Twig** : snake_case
   ```twig
   {% set is_featured = node.field_featured.value %}
   {% set product_classes = ['product', 'product--' ~ view_mode] %}
   ```

3. **Toujours commenter** :
   ```twig
   {# Badge promo si prix barr√© existe #}
   {% if old_price %}
     <span class="badge badge--sale">-{{ discount }}%</span>
   {% endif %}
   ```

### üîß D√©bogage

**Afficher les variables disponibles**

```twig
{# En mode debug uniquement #}
{{ dump() }}                  {# Toutes les variables #}
{{ dump(node) }}             {# Variable sp√©cifique #}
{{ dump(node.field_price) }} {# Champ sp√©cifique #}
```

<Aside type="caution" title="Attention">
`dump()` ne fonctionne qu'avec le module **Devel** activ√© et le d√©bogage Twig activ√©. Ne JAMAIS laisser de `dump()` en production !
</Aside>

**Inspecter les suggestions de templates**

Avec le d√©bogage Twig activ√©, inspectez le HTML source (Ctrl+U) pour voir :
- Les suggestions de noms de fichiers
- Le template actuellement utilis√©
- Les variables disponibles

### üìù Checklist qualit√© template

Avant de valider un template :

- [ ] √âchappement automatique pr√©serv√© (pas de `|raw` inutile)
- [ ] V√©rifications `|render` pour les champs optionnels
- [ ] Balises s√©mantiques HTML5 (header, nav, main, aside, footer)
- [ ] Attributs ARIA appropri√©s
- [ ] Classes CSS coh√©rentes (BEM ou convention choisie)
- [ ] Commentaires Twig pour expliquer la logique
- [ ] Pas de `dump()` oubli√©
- [ ] Responsive (mobile-first avec Tailwind)
- [ ] Images avec attribut `alt`
- [ ] Skip link pour navigation clavier

## ‚úÖ Checklist de validation

### Templates cr√©√©s et fonctionnels

| Template | Emplacement | Validation | Statut |
|----------|-------------|------------|--------|
| `page.html.twig` | `templates/layout/` | Inspecter la structure HTML | ‚¨ú |
| `node--product.html.twig` | `templates/node/` | Visiter une page produit | ‚¨ú |
| `node--product--card.html.twig` | `templates/node/` | Voir la grille de produits | ‚¨ú |
| `block--system-branding-block.html.twig` | `templates/block/` | V√©rifier le logo | ‚¨ú |

### V√©rifications techniques

<Steps>

1. **D√©bogage Twig activ√©**
   ```bash
   # V√©rifier la config
   grep -A3 "twig.config" sites/default/services.yml
   ```
   **Attendu** : `debug: true`, `auto_reload: true`, `cache: false`

2. **Templates d√©tect√©s par Drupal**
   ```bash
   # Vider le cache
   drush cr
   
   # V√©rifier les suggestions dans le HTML source (Ctrl+U)
   # Chercher "THEME DEBUG" dans le code source
   ```

3. **Pas d'erreurs dans les logs**
   ```bash
   drush watchdog:show --severity=Error --count=20
   ```
   **Attendu** : Aucune erreur Twig

4. **Templates compil√©s**
   ```bash
   ls -la sites/default/files/php/twig/
   ```
   **Attendu** : Fichiers .php g√©n√©r√©s pour chaque template

</Steps>

### Tests fonctionnels

- [ ] La structure HTML de la page est personnalis√©e
- [ ] Les produits s'affichent avec le bon template (mode full)
- [ ] Les cartes produits utilisent le template card
- [ ] Les badges (nouveau, promo) s'affichent correctement
- [ ] Les conditions (stock, prix) fonctionnent
- [ ] Les boucles (couleurs, tailles) affichent les bonnes donn√©es
- [ ] Pas de code PHP visible dans le HTML
- [ ] Responsive fonctionne (tester mobile F12)

### Commande r√©capitulative

```bash
# Script de validation complet
echo "=== V√©rification templates Twig ==="

# 1. Config Twig debug
if grep -q "debug: true" sites/default/services.yml; then
  echo "‚úÖ Debug Twig activ√©"
else
  echo "‚ùå Debug Twig d√©sactiv√©"
fi

# 2. Templates pr√©sents
echo "\nüìÅ Templates trouv√©s :"
find themes/custom/tailstore/templates -name "*.twig" -type f

# 3. Cache Twig
echo "\nüóÇÔ∏è Templates compil√©s :"
ls -1 sites/default/files/php/twig/*.php | wc -l
echo "fichiers compil√©s"

# 4. Erreurs r√©centes
echo "\n‚ö†Ô∏è Erreurs r√©centes :"
drush watchdog:show --severity=Error --count=5

echo "\n‚úÖ V√©rification termin√©e"
```

**Temps estim√© total** : 2-3 heures pour cr√©er et tester tous les templates

## ÔøΩ Erreurs courantes et solutions

### Erreur 1 : Template non d√©tect√©

**Sympt√¥me** : Modifications du template non visibles

**Causes possibles** :
- Cache non vid√©
- Nom de fichier incorrect
- Mauvais emplacement

**Solution** :
```bash
# 1. Vider le cache
drush cr

# 2. V√©rifier le nom exact sugg√©r√©
# Activer debug Twig et inspecter le HTML source (Ctrl+U)
# Chercher "FILE NAME SUGGESTIONS"

# 3. V√©rifier l'emplacement
ls -la themes/custom/tailstore/templates/node/node--product.html.twig
```

### Erreur 2 : Variable undefined

**Sympt√¥me** : `Warning: Undefined variable`

**Cause** : Variable non pr√©process√©e ou mal nomm√©e

**Solution** :
```twig
{# ‚ùå Mauvais - Erreur si la variable n'existe pas #}
{{ my_custom_var }}

{# ‚úÖ Bon - V√©rifie l'existence #}
{% if my_custom_var is defined %}
  {{ my_custom_var }}
{% endif %}

{# ‚úÖ Ou avec valeur par d√©faut #}
{{ my_custom_var|default('Valeur par d√©faut') }}
```

### Erreur 3 : Champ vide g√©n√®re du HTML

**Sympt√¥me** : Balises vides dans le HTML (`<div></div>`)

**Cause** : Condition sur le champ sans v√©rifier le rendu

**Solution** :
```twig
{# ‚ùå Mauvais - G√©n√®re des balises vides #}
{% if content.field_description %}
  <div class="description">
    {{ content.field_description }}
  </div>
{% endif %}

{# ‚úÖ Bon - V√©rifie vraiment le contenu #}
{% if content.field_description|render %}
  <div class="description">
    {{ content.field_description }}
  </div>
{% endif %}
```

### Erreur 4 : Boucle infinie ou erreur de syntaxe

**Sympt√¥me** : Page blanche, timeout, ou erreur Twig

**Solution** :
```bash
# 1. Consulter les logs Drupal
drush watchdog:show --severity=Error

# 2. Consulter les logs PHP
tail -f sites/default/files/php-errors.log

# 3. D√©sactiver temporairement le template
mv themes/custom/tailstore/templates/node/node--product.html.twig \
   themes/custom/tailstore/templates/node/node--product.html.twig.bak
   
drush cr
```

### Erreur 5 : Styles CSS non appliqu√©s

**Sympt√¥me** : Classes pr√©sentes mais pas de style

**Cause** : Probl√®me de chargement CSS, pas de probl√®me Twig

**Solution** :
```bash
# V√©rifier que la librairie CSS est charg√©e
# F12 ‚Üí Network ‚Üí Filtrer CSS
# V√©rifier que tailstore.css est charg√© (statut 200)

# Vider le cache CSS
drush cc css-js
drush cr
```

<Aside type="tip" title="Outil de d√©bogage : Twig Vardumper">
Installez le module **Devel** pour utiliser `{{ dump() }}` :

```bash
composer require --dev drupal/devel
drush pm:enable devel
```

Utilisation :
```twig
{{ dump(node) }}              {# Affiche toute la structure #}
{{ dump(node.field_price) }}  {# Affiche un champ sp√©cifique #}
```
</Aside>

## üìö Ressources compl√©mentaires

### Documentation officielle

- [Twig Documentation](https://twig.symfony.com/doc/) - Documentation compl√®te Twig
- [Drupal Twig](https://www.drupal.org/docs/theming-drupal/twig-in-drupal) - Twig dans Drupal
- [Twig Filters](https://www.drupal.org/docs/theming-drupal/twig-in-drupal/filters-modifying-variables-in-twig-templates) - Liste des filtres
- [Twig Functions](https://www.drupal.org/docs/theming-drupal/twig-in-drupal/functions-in-twig-templates) - Fonctions disponibles

### Outils utiles

- **Extension VS Code** : Twig Language 2 (autocompl√©tion, coloration)
- **Module Drupal** : Devel (dump, Kint pour debug)
- **Module Drupal** : Twig Tweak (fonctions Twig suppl√©mentaires)

### Exemples de code

- [Drupal Core Templates](https://git.drupalcode.org/project/drupal/-/tree/11.x/core/themes/olivero/templates) - Templates Olivero
- [Twig Recipes](https://www.drupal.org/docs/theming-drupal/twig-in-drupal/twig-template-recipes) - Recettes pratiques

## üîú Prochaine √©tape

Les templates sont en place ! Passons aux [Assets (CSS/JS)](/etape-6-theming/assets/) pour styliser tout √ßa avec Tailwind CSS.
