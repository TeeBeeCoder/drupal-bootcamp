---
title: Assets (CSS/JS)
description: G√©rer les fichiers CSS et JavaScript dans un th√®me Drupal
sidebar:
  order: 3

# status: stable
# last-reviewed: 2026-01-14
---

import { Tabs, TabItem, Aside, Steps } from '@astrojs/starlight/components';

## üìö Syst√®me de librairies Drupal

Drupal utilise un syst√®me de **librairies** pour g√©rer les assets CSS et JavaScript. Contrairement √† l'inclusion classique de fichiers dans le `<head>`, ce syst√®me offre un contr√¥le granulaire et des optimisations automatiques.

### üéØ Pourquoi un syst√®me de librairies ?

**Probl√®mes de l'approche classique** :
```html
<!-- ‚ùå Mauvais : Chargement non optimis√© #}
<link rel="stylesheet" href="/style.css">
<script src="/script.js"></script>
```

**Avantages du syst√®me Drupal** :
- ‚úÖ **Chargement conditionnel** : Ne charger que ce qui est n√©cessaire
- ‚úÖ **Gestion des d√©pendances** : Ordre de chargement automatique
- ‚úÖ **Agr√©gation** : Combine plusieurs fichiers en un seul
- ‚úÖ **Minification** : R√©duit la taille des fichiers en production
- ‚úÖ **Cache optimis√©** : Cache navigateur avec busting automatique
- ‚úÖ **Pr√©vention des doublons** : Un fichier n'est charg√© qu'une seule fois

### üîÑ Cycle de vie d'un asset

```
1. D√©claration dans .libraries.yml
         ‚Üì
2. Attachement (global, template, PHP)
         ‚Üì
3. R√©solution des d√©pendances
         ‚Üì
4. Agr√©gation (si activ√©e)
         ‚Üì
5. Minification (si activ√©e)
         ‚Üì
6. Injection dans le HTML (<head> ou avant </body>)
         ‚Üì
7. Cache navigateur avec version
```

### üåê Vue d'ensemble

| Fichier | R√¥le | Exemple |
|---------|-------|----------|
| `*.libraries.yml` | D√©clare les librairies | `tailstore.libraries.yml` |
| `*.info.yml` | Attache globalement | `libraries: - tailstore/global` |
| `*.theme` | Attache en PHP | `$variables['#attached']['library'][]` |
| Templates Twig | Attache dans un template | `{{ attach_library('tailstore/slider') }}` |

## üé® D√©clarer des CSS

### Structure du fichier .libraries.yml

```yaml
# tailstore.libraries.yml

global:
  version: 1.0
  css:
    # Cat√©gories (ordre de chargement)
    base:
      css/base/reset.css: {}
      css/base/typography.css: {}
    layout:
      css/layout/grid.css: {}
      css/layout/regions.css: {}
    component:
      css/components/buttons.css: {}
      css/components/cards.css: {}
      css/components/forms.css: {}
    theme:
      css/tailstore.css: {}
```

### Cat√©gories CSS

| Cat√©gorie | Poids | Usage |
|-----------|-------|-------|
| `base` | -200 | Reset, normalisation |
| `layout` | -100 | Grilles, mise en page |
| `component` | 0 | Composants |
| `state` | 100 | √âtats (hover, active) |
| `theme` | 200 | Styles finaux, surcharges |

### Options CSS

```yaml
css:
  theme:
    css/style.css:
      weight: 10                    # Poids relatif
      media: screen                 # Media query
      preprocess: true              # Agr√©gation
      minified: false               # D√©j√† minifi√©
      attributes:
        crossorigin: anonymous
```

## üìú D√©clarer des JavaScript

```yaml
global:
  js:
    js/tailstore.js: {}
  dependencies:
    - core/drupal
    - core/once

cart:
  js:
    js/cart.js:
      attributes:
        defer: true
  dependencies:
    - core/drupalSettings
    - tailstore/global
```

### Options JavaScript

```yaml
js:
  js/script.js:
    weight: -10                    # Chargement prioritaire
    minified: true                 # Fichier d√©j√† minifi√©
    preprocess: true               # Inclure dans l'agr√©gation
    attributes:
      defer: true                  # Attribut defer
      async: true                  # Attribut async
      type: module                 # ES modules
```

### D√©pendances courantes

| D√©pendance | Description |
|------------|-------------|
| `core/drupal` | Objet Drupal, behaviors |
| `core/once` | Helper pour ex√©cuter une seule fois |
| `core/jquery` | jQuery (√©viter si possible) |
| `core/drupalSettings` | Variables PHP ‚Üí JS |

## üîó Attacher les librairies

### 1. Globalement (toutes les pages)

Dans `tailstore.info.yml` :

```yaml
libraries:
  - tailstore/global
```

### 2. Dans un template Twig

```twig
{{ attach_library('tailstore/slider') }}

<div class="slider">
  {# Contenu du slider #}
</div>
```

### 3. Dans un preprocess PHP

```php
function tailstore_preprocess_node(&$variables) {
  if ($variables['node']->bundle() === 'product') {
    $variables['#attached']['library'][] = 'tailstore/product';
  }
}
```

### 4. Dans un contr√¥leur/service

```php
public function build() {
  return [
    '#markup' => '<div class="my-component"></div>',
    '#attached' => [
      'library' => ['tailstore/component'],
      'drupalSettings' => [
        'tailstore' => [
          'apiUrl' => '/api/endpoint',
        ],
      ],
    ],
  ];
}
```

## üåê CDN et ressources externes

### D√©clarer une librairie externe

```yaml
swiper:
  version: 11.0
  remote: https://swiperjs.com/
  license:
    name: MIT
    url: https://github.com/nolimits4web/swiper/blob/master/LICENSE
    gpl-compatible: true
  css:
    theme:
      https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css:
        type: external
        minified: true
  js:
    https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js:
      type: external
      minified: true
```

<Aside type="caution" title="Licence GPL">
Les librairies externes doivent √™tre GPL-compatible pour √™tre distribu√©es avec Drupal.
</Aside>

## üîÑ Surcharger des librairies

### libraries-override

Dans `tailstore.info.yml` :

```yaml
libraries-override:
  # D√©sactiver compl√®tement une librairie
  core/normalize: false
  
  # Remplacer un fichier CSS
  core/drupal.vertical-tabs:
    css:
      component:
        misc/vertical-tabs.css: css/components/vertical-tabs.css
  
  # Remplacer par une librairie CDN
  core/jquery: tailstore/jquery-cdn
```

### libraries-extend

Ajouter des assets √† une librairie existante :

```yaml
libraries-extend:
  core/ckeditor5:
    - tailstore/ckeditor-custom
```

## üíª JavaScript moderne

### Drupal Behaviors

```javascript
// js/tailstore.js

(function (Drupal, once) {
  'use strict';

  /**
   * Product gallery behavior.
   */
  Drupal.behaviors.productGallery = {
    attach: function (context, settings) {
      // once() s'assure que le code ne s'ex√©cute qu'une fois par √©l√©ment
      once('product-gallery', '.product__gallery', context).forEach(function (gallery) {
        const thumbnails = gallery.querySelectorAll('.product__thumbnail');
        const mainImage = gallery.querySelector('.product__main-image img');

        thumbnails.forEach(function (thumb) {
          thumb.addEventListener('click', function () {
            const img = this.querySelector('img');
            mainImage.src = img.src;
            mainImage.alt = img.alt;

            // Active state
            thumbnails.forEach(t => t.classList.remove('active'));
            this.classList.add('active');
          });
        });
      });
    },
    
    detach: function (context, settings, trigger) {
      // Nettoyage si n√©cessaire (avant suppression AJAX)
      if (trigger === 'unload') {
        // Cleanup code
      }
    }
  };

  /**
   * Add to cart behavior.
   */
  Drupal.behaviors.addToCart = {
    attach: function (context, settings) {
      once('add-to-cart', '.product__add-to-cart', context).forEach(function (button) {
        button.addEventListener('click', function () {
          const productId = this.dataset.productId;
          const quantity = document.getElementById('quantity')?.value || 1;

          // R√©cup√©rer les options
          const size = document.querySelector('.size-btn.active')?.dataset.size;
          const color = document.querySelector('.color-btn.active')?.dataset.color;

          // Appel API ou action
          Drupal.tailstore.addToCart(productId, quantity, { size, color });
        });
      });
    }
  };

  /**
   * Namespace pour les fonctions TailStore.
   */
  Drupal.tailstore = {
    addToCart: function (productId, quantity, options) {
      console.log('Adding to cart:', productId, quantity, options);
      
      // Exemple avec fetch
      fetch('/api/cart/add', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          product_id: productId,
          quantity: quantity,
          options: options,
        }),
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          // Mettre √† jour l'ic√¥ne panier
          document.dispatchEvent(new CustomEvent('cart-updated', {
            detail: data.cart
          }));
          
          // Notification
          Drupal.announce(Drupal.t('Product added to cart'));
        }
      });
    }
  };

})(Drupal, once);
```

### Utiliser drupalSettings

**PHP (dans .theme ou module) :**

```php
function tailstore_preprocess_page(&$variables) {
  $variables['#attached']['drupalSettings']['tailstore'] = [
    'cartApiUrl' => '/api/cart',
    'currency' => '‚Ç¨',
    'locale' => 'fr-FR',
  ];
}
```

**JavaScript :**

```javascript
(function (Drupal, drupalSettings) {
  const config = drupalSettings.tailstore;
  
  console.log('API URL:', config.cartApiUrl);
  console.log('Currency:', config.currency);
})(Drupal, drupalSettings);
```

## üì¶ CSS Composants

### css/components/buttons.css

```css
/* Variables boutons */
:root {
  --btn-padding-x: 1rem;
  --btn-padding-y: 0.5rem;
  --btn-border-radius: 0.375rem;
  --btn-font-weight: 600;
  --btn-transition: all 0.2s ease;
}

/* Base button */
.btn {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 0.5rem;
  padding: var(--btn-padding-y) var(--btn-padding-x);
  font-weight: var(--btn-font-weight);
  text-align: center;
  text-decoration: none;
  border: 1px solid transparent;
  border-radius: var(--btn-border-radius);
  cursor: pointer;
  transition: var(--btn-transition);
}

.btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

/* Variantes */
.btn--primary {
  background-color: var(--color-primary);
  color: white;
}

.btn--primary:hover:not(:disabled) {
  background-color: var(--color-primary-dark);
}

.btn--secondary {
  background-color: var(--color-secondary);
  color: white;
}

.btn--outline {
  background-color: transparent;
  border-color: currentColor;
}

.btn--outline:hover:not(:disabled) {
  background-color: var(--color-primary);
  border-color: var(--color-primary);
  color: white;
}

/* Tailles */
.btn--sm {
  padding: 0.25rem 0.5rem;
  font-size: 0.875rem;
}

.btn--lg {
  padding: 0.75rem 1.5rem;
  font-size: 1.125rem;
}

.btn--full {
  width: 100%;
}
```

### css/components/cards.css

```css
/* Product Card */
.product-card {
  position: relative;
  display: flex;
  flex-direction: column;
  background: white;
  border-radius: 0.5rem;
  overflow: hidden;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  transition: transform 0.2s, box-shadow 0.2s;
}

.product-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.product-card__badges {
  position: absolute;
  top: 0.5rem;
  left: 0.5rem;
  z-index: 10;
  display: flex;
  gap: 0.25rem;
}

.product-card__image-link {
  display: block;
  aspect-ratio: 1;
  overflow: hidden;
}

.product-card__image-link img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  transition: transform 0.3s;
}

.product-card:hover .product-card__image-link img {
  transform: scale(1.05);
}

.product-card__quick-actions {
  position: absolute;
  top: 0.5rem;
  right: 0.5rem;
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
  opacity: 0;
  transform: translateX(10px);
  transition: opacity 0.2s, transform 0.2s;
}

.product-card:hover .product-card__quick-actions {
  opacity: 1;
  transform: translateX(0);
}

.product-card__info {
  padding: 1rem;
  flex-grow: 1;
  display: flex;
  flex-direction: column;
  gap: 0.25rem;
}

.product-card__brand {
  font-size: 0.75rem;
  color: var(--color-secondary);
  text-transform: uppercase;
  letter-spacing: 0.05em;
}

.product-card__title {
  font-size: 1rem;
  font-weight: 600;
  line-height: 1.3;
}

.product-card__title a {
  color: inherit;
  text-decoration: none;
}

.product-card__title a:hover {
  color: var(--color-primary);
}

.product-card__price {
  margin-top: auto;
  padding-top: 0.5rem;
}

.price--current {
  font-size: 1.25rem;
  font-weight: 700;
  color: var(--color-dark);
}

.price--sale {
  color: var(--color-danger);
}

.price--old {
  font-size: 0.875rem;
  color: var(--color-secondary);
  text-decoration: line-through;
  margin-right: 0.5rem;
}

.product-card__colors {
  display: flex;
  gap: 0.25rem;
  margin-top: 0.5rem;
}

.color-dot {
  width: 1rem;
  height: 1rem;
  border-radius: 50%;
  border: 1px solid rgba(0, 0, 0, 0.1);
}

.product-card__add-to-cart {
  margin: 1rem;
  margin-top: 0;
}
```

## üéØ Exercices pratiques

### Exercice 1 : Cr√©er une librairie CSS basique

**Objectif** : Cr√©er et attacher une librairie CSS simple pour personnaliser les boutons.

<Steps>

1. Cr√©ez le fichier CSS :
   ```bash
   mkdir -p themes/custom/tailstore/css/components
   touch themes/custom/tailstore/css/components/buttons.css
   ```

2. Ajoutez des styles de test :
   ```css
   /* css/components/buttons.css */
   .btn-test {
     background-color: #ff6b6b;
     color: white;
     padding: 10px 20px;
     border-radius: 5px;
     border: none;
   }
   ```

3. D√©clarez la librairie dans `tailstore.libraries.yml` :
   ```yaml
   buttons:
     version: 1.0.0
     css:
       component:
         css/components/buttons.css: {}
   ```

4. Attachez-la globalement dans `tailstore.info.yml` :
   ```yaml
   libraries:
     - tailstore/global
     - tailstore/buttons
   ```

5. Videz le cache :
   ```bash
   drush cr
   ```

6. Testez en ajoutant un bouton quelque part :
   ```html
   <button class="btn-test">Test Button</button>
   ```

</Steps>

**Validation** : ‚úÖ Le bouton doit avoir un fond rouge avec le style appliqu√©

---

### Exercice 2 : Librairie JavaScript avec Drupal.behaviors

**Objectif** : Cr√©er un script qui affiche une alerte au clic sur un bouton.

<Steps>

1. Cr√©ez le fichier JS :
   ```bash
   mkdir -p themes/custom/tailstore/js
   touch themes/custom/tailstore/js/alert.js
   ```

2. Ajoutez le code :
   ```javascript
   (function (Drupal, once) {
     'use strict';
     
     Drupal.behaviors.testAlert = {
       attach: function (context, settings) {
         once('test-alert', '.btn-alert', context).forEach(function (button) {
           button.addEventListener('click', function () {
             alert('Hello from Drupal!');
           });
         });
       }
     };
     
   })(Drupal, once);
   ```

3. D√©clarez dans `tailstore.libraries.yml` :
   ```yaml
   alert:
     version: 1.0.0
     js:
       js/alert.js: {}
     dependencies:
       - core/drupal
       - core/once
   ```

4. Attachez dans un template ou globalement

5. Testez avec :
   ```html
   <button class="btn-alert">Click me!</button>
   ```

</Steps>

**Validation** : ‚úÖ Un clic sur le bouton doit afficher "Hello from Drupal!"

---

### Exercice 3 : Chargement conditionnel

**Objectif** : Charger une librairie uniquement sur les pages produit.

<Steps>

1. Cr√©ez une librairie pour les produits :
   ```yaml
   # tailstore.libraries.yml
   product-zoom:
     version: 1.0.0
     js:
       js/product-zoom.js: {}
     dependencies:
       - tailstore/global
   ```

2. Attachez conditionnellement dans `tailstore.theme` :
   ```php
   function tailstore_preprocess_node(&$variables) {
     $node = $variables['node'];
     
     if ($node->bundle() === 'product') {
       $variables['#attached']['library'][] = 'tailstore/product-zoom';
     }
   }
   ```

3. Videz le cache et testez :
   ```bash
   drush cr
   ```

4. V√©rifiez (F12 ‚Üí Network) :
   - Sur une page produit : `product-zoom.js` est charg√©
   - Sur une autre page : `product-zoom.js` n'est PAS charg√©

</Steps>

**Validation** : ‚úÖ La librairie ne se charge que sur les pages produit

---

### Exercice 4 : Utiliser drupalSettings

**Objectif** : Passer des donn√©es PHP vers JavaScript.

<Steps>

1. Dans `tailstore.theme`, ajoutez des settings :
   ```php
   function tailstore_preprocess_page(&$variables) {
     $variables['#attached']['drupalSettings']['tailstore'] = [
       'siteUrl' => \Drupal::request()->getSchemeAndHttpHost(),
       'currency' => '‚Ç¨',
       'locale' => 'fr-FR',
     ];
   }
   ```

2. Cr√©ez `js/settings-test.js` :
   ```javascript
   (function (Drupal, drupalSettings) {
     'use strict';
     
     Drupal.behaviors.settingsTest = {
       attach: function (context, settings) {
         console.log('Site URL:', drupalSettings.tailstore.siteUrl);
         console.log('Currency:', drupalSettings.tailstore.currency);
         console.log('Locale:', drupalSettings.tailstore.locale);
       }
     };
     
   })(Drupal, drupalSettings);
   ```

3. D√©clarez la librairie et attachez-la

4. Ouvrez la console (F12) et v√©rifiez les logs

</Steps>

**Validation** : ‚úÖ Les valeurs PHP apparaissent dans la console JavaScript

## üß† Bonnes pratiques essentielles

### ‚ö° Performance

**1. Charger uniquement ce qui est n√©cessaire**

```php
// ‚ùå Mauvais - Charge partout
// Dans tailstore.info.yml
libraries:
  - tailstore/slider
  - tailstore/cart
  - tailstore/filters

// ‚úÖ Bon - Charge conditionnellement
function tailstore_preprocess_page(&$variables) {
  // Slider uniquement sur homepage
  if (\Drupal::service('path.matcher')->isFrontPage()) {
    $variables['#attached']['library'][] = 'tailstore/slider';
  }
  
  // Panier uniquement si utilisateur connect√©
  if (\Drupal::currentUser()->isAuthenticated()) {
    $variables['#attached']['library'][] = 'tailstore/cart';
  }
}
```

**2. Utiliser defer pour les scripts non critiques**

```yaml
analytics:
  version: 1.0.0
  js:
    js/analytics.js:
      attributes:
        defer: true  # Charge apr√®s le DOM
```

**3. Pr√©charger les ressources critiques**

```php
function tailstore_preprocess_html(&$variables) {
  $variables['#attached']['html_head_link'][][] = [
    'rel' => 'preload',
    'href' => '/themes/custom/tailstore/fonts/inter.woff2',
    'as' => 'font',
    'type' => 'font/woff2',
    'crossorigin' => 'anonymous',
  ];
}
```

**4. Activer l'agr√©gation en production**

```bash
# Mode production
drush config:set system.performance css.preprocess true -y
drush config:set system.performance js.preprocess true -y
drush cr
```

<Aside type="tip" title="Impact performance">
**Sans agr√©gation** : 15 requ√™tes CSS + 20 requ√™tes JS = 35 requ√™tes  
**Avec agr√©gation** : 1 requ√™te CSS + 1 requ√™te JS = 2 requ√™tes

üöÄ **Gain** : 94% de requ√™tes en moins !
</Aside>

### üîí S√©curit√©

**1. Toujours d√©clarer les d√©pendances**

```yaml
# ‚ùå Dangereux - Suppose que Drupal est disponible
cart:
  js:
    js/cart.js: {}

# ‚úÖ S√©curis√© - D√©clare explicitement
cart:
  js:
    js/cart.js: {}
  dependencies:
    - core/drupal
    - core/once
```

**2. Valider les donn√©es drupalSettings**

```javascript
// ‚ùå Dangereux - Peut crasher si non d√©fini
const apiUrl = drupalSettings.tailstore.apiUrl;

// ‚úÖ S√©curis√© - V√©rifie l'existence
const apiUrl = drupalSettings.tailstore?.apiUrl || '/api/default';
```

**3. √âviter eval() et innerHTML**

```javascript
// ‚ùå Dangereux - Faille XSS
element.innerHTML = userInput;

// ‚úÖ S√©curis√©
element.textContent = userInput;
// Ou
element.insertAdjacentText('beforeend', userInput);
```

### üìù Conventions de code

**1. Nommage des librairies**

```yaml
# Format : theme-nom/fonctionnalite
tailstore/global          # Librairie de base
tailstore/product-zoom    # Fonctionnalit√© sp√©cifique
tailstore/cart            # Composant
```

**2. Structure JavaScript**

```javascript
(function (Drupal, once) {
  'use strict';
  
  // 1. Namespace pour √©viter les conflits
  Drupal.tailstore = Drupal.tailstore || {};
  
  // 2. Fonctions priv√©es
  function privateHelper() {
    // ...
  }
  
  // 3. Behavior Drupal
  Drupal.behaviors.myFeature = {
    attach: function (context, settings) {
      once('my-feature', '.selector', context).forEach(function (element) {
        // Code d'initialisation
      });
    }
  };
  
  // 4. Fonctions publiques
  Drupal.tailstore.publicMethod = function () {
    return privateHelper();
  };
  
})(Drupal, once);
```

**3. Commentaires obligatoires**

```javascript
/**
 * @file
 * Product gallery functionality.
 */

/**
 * Gallery behavior.
 * 
 * Handles thumbnail clicks and updates the main image.
 */
Drupal.behaviors.productGallery = {
  // ...
};
```

### ‚ôø Accessibilit√©

**1. Annoncer les changements dynamiques**

```javascript
// Utiliser Drupal.announce() pour les lecteurs d'√©cran
button.addEventListener('click', function () {
  addToCart(productId);
  Drupal.announce(Drupal.t('Product added to cart'));
});
```

**2. G√©rer le focus**

```javascript
// Apr√®s ouverture d'une modale
modal.querySelector('.modal__close').focus();

// Pi√®ge du focus dans la modale
modal.addEventListener('keydown', function (e) {
  if (e.key === 'Tab') {
    // Logique de trap focus
  }
});
```

**3. Support clavier**

```javascript
element.addEventListener('keydown', function (e) {
  if (e.key === 'Enter' || e.key === ' ') {
    e.preventDefault();
    this.click();
  }
});
```

## üîß V√©rifier le chargement

```bash
# Mode d√©veloppement
drush state:set system.performance css_preprocess 0
drush state:set system.performance js_preprocess 0
drush cr

# Mode production
drush state:set system.performance css_preprocess 1
drush state:set system.performance js_preprocess 1
drush cr
```

Inspectez le code source HTML pour voir les fichiers charg√©s.

<Aside type="tip" title="Outils de d√©bogage">
**Dans le navigateur (F12)** :
- **Network** : Voir tous les fichiers charg√©s (CSS, JS)
- **Console** : Voir les erreurs JavaScript
- **Performance** : Analyser les temps de chargement

**Commandes Drush** :
```bash
# Lister les librairies d'un th√®me
drush php-eval "print_r(\Drupal::service('library.discovery')->getLibrariesByExtension('tailstore'));"

# V√©rifier si une librairie existe
drush php-eval "var_dump(\Drupal::service('library.discovery')->getLibraryByName('tailstore', 'global'));"
```
</Aside>

## ‚úÖ Checklist de validation

### Librairies cr√©√©es

| Librairie | Contenu | Attachement | Statut |
|-----------|---------|-------------|--------|
| `global` | CSS/JS de base | Global (`info.yml`) | ‚¨ú |
| `buttons` | Styles boutons | Global | ‚¨ú |
| `product-zoom` | JS zoom images | Conditionnel (produits) | ‚¨ú |
| `cart` | JS panier | Conditionnel | ‚¨ú |

### V√©rifications techniques

<Steps>

1. **Fichiers d√©clar√©s dans .libraries.yml**
   ```bash
   # V√©rifier la syntaxe YAML
   cat themes/custom/tailstore/tailstore.libraries.yml | grep -A 5 "global:"
   ```
   **Attendu** : Syntaxe YAML valide, `version:` obligatoire

2. **Fichiers existent sur le disque**
   ```bash
   # V√©rifier que les fichiers CSS/JS existent
   find themes/custom/tailstore -name "*.css" -o -name "*.js"
   ```
   **Attendu** : Tous les fichiers d√©clar√©s sont pr√©sents

3. **Librairies charg√©es dans le HTML**
   ```bash
   # Inspecter le code source (Ctrl+U)
   # Chercher <link> et <script>
   curl -s http://localhost/ | grep -E "<link|<script" | head -10
   ```
   **Attendu** : Fichiers CSS dans `<head>`, JS avant `</body>`

4. **Pas d'erreurs 404**
   ```bash
   # Ouvrir F12 ‚Üí Network ‚Üí Filtrer par "CSS" et "JS"
   # V√©rifier que tous les fichiers sont en statut 200
   ```

5. **JavaScript fonctionnel**
   ```bash
   # Ouvrir F12 ‚Üí Console
   # V√©rifier qu'il n'y a pas d'erreurs
   ```

6. **Agr√©gation (production uniquement)**
   ```bash
   # V√©rifier la config
   drush config:get system.performance css.preprocess
   drush config:get system.performance js.preprocess
   
   # En production, les deux doivent √™tre √† true
   ```

</Steps>

### Tests fonctionnels

- [ ] Les styles CSS sont appliqu√©s (boutons, cartes, etc.)
- [ ] Les Drupal.behaviors fonctionnent (interactions)
- [ ] Les librairies conditionnelles se chargent au bon moment
- [ ] drupalSettings est accessible en JavaScript
- [ ] Pas d'erreurs dans la console (F12)
- [ ] Performance acceptable (< 3s chargement)
- [ ] Responsive fonctionne (mobile, tablette, desktop)

### Script de validation complet

```bash
#!/bin/bash

echo "=== V√©rification Assets TailStore ==="

# 1. V√©rifier fichiers CSS
echo "\nüé® Fichiers CSS :"
find themes/custom/tailstore -name "*.css" -type f | wc -l
echo "fichiers CSS trouv√©s"

# 2. V√©rifier fichiers JS
echo "\nüìú Fichiers JavaScript :"
find themes/custom/tailstore -name "*.js" -type f | wc -l
echo "fichiers JS trouv√©s"

# 3. V√©rifier syntaxe YAML
echo "\n‚öôÔ∏è Validation YAML :"
if command -v yamllint &> /dev/null; then
  yamllint themes/custom/tailstore/tailstore.libraries.yml
else
  echo "yamllint non install√©, validation manuelle n√©cessaire"
fi

# 4. V√©rifier agr√©gation
echo "\nüì¶ Agr√©gation CSS/JS :"
drush config:get system.performance css.preprocess
drush config:get system.performance js.preprocess

# 5. V√©rifier erreurs logs
echo "\n‚ö†Ô∏è Erreurs r√©centes :"
drush watchdog:show --severity=Error --count=5 | grep -i "javascript\|css" || echo "Aucune erreur asset"

echo "\n‚úÖ V√©rification termin√©e"
```

**Temps estim√© total** : 2-3 heures pour cr√©er et tester tous les assets

## üö® Erreurs courantes et solutions

### Erreur 1 : Fichier CSS/JS non charg√© (404)

**Sympt√¥me** : Erreur 404 dans Network (F12)

**Causes possibles** :
- Chemin incorrect dans `.libraries.yml`
- Fichier n'existe pas sur le disque
- Permissions incorrectes

**Solution** :
```bash
# 1. V√©rifier le chemin exact
ls -la themes/custom/tailstore/css/style.css

# 2. V√©rifier la d√©claration dans .libraries.yml
cat themes/custom/tailstore/tailstore.libraries.yml | grep "css/style.css"

# 3. V√©rifier les permissions
chmod 644 themes/custom/tailstore/css/*.css
chmod 644 themes/custom/tailstore/js/*.js

# 4. Vider le cache
drush cr
```

### Erreur 2 : JavaScript ne fonctionne pas

**Sympt√¥me** : Pas d'erreur mais le code ne s'ex√©cute pas

**Causes** :
- D√©pendances manquantes (`core/drupal`, `core/once`)
- Syntaxe JavaScript incorrecte
- `once()` mal utilis√©

**Solution** :
```javascript
// ‚ùå Mauvais - D√©pendances manquantes
(function () {
  document.querySelectorAll('.btn').forEach(function (btn) {
    btn.addEventListener('click', function () {
      // ...
    });
  });
})();

// ‚úÖ Bon - Drupal.behaviors + once
(function (Drupal, once) {
  'use strict';
  
  Drupal.behaviors.myFeature = {
    attach: function (context, settings) {
      once('my-feature', '.btn', context).forEach(function (btn) {
        btn.addEventListener('click', function () {
          // ...
        });
      });
    }
  };
  
})(Drupal, once);
```

```yaml
# D√©clarer les d√©pendances
my-library:
  js:
    js/script.js: {}
  dependencies:
    - core/drupal
    - core/once
```

### Erreur 3 : "Drupal is not defined"

**Sympt√¥me** : Erreur console JavaScript

**Cause** : Librairie charg√©e avant `core/drupal`

**Solution** :
```yaml
# Toujours d√©clarer core/drupal en d√©pendance
my-library:
  js:
    js/script.js: {}
  dependencies:
    - core/drupal  # üëà Obligatoire !
```

### Erreur 4 : Styles CSS ne s'appliquent pas

**Sympt√¥me** : Fichier charg√© (200) mais styles invisibles

**Causes** :
- Sp√©cificit√© CSS insuffisante
- Cache navigateur
- Ordre de chargement

**Solution** :
```bash
# 1. Vider le cache Drupal
drush cr

# 2. Vider le cache navigateur
# Ctrl+Shift+R (Chrome/Firefox)

# 3. V√©rifier l'ordre de chargement
# Utiliser weight dans .libraries.yml
```

```yaml
global:
  css:
    theme:
      css/base.css:
        weight: -10  # Charge en premier
      css/custom.css:
        weight: 10   # Charge apr√®s
```

### Erreur 5 : "once is not defined"

**Sympt√¥me** : Erreur JavaScript en production

**Cause** : D√©pendance `core/once` non d√©clar√©e

**Solution** :
```yaml
my-library:
  js:
    js/script.js: {}
  dependencies:
    - core/drupal
    - core/once     # üëà N√©cessaire pour once()
```

### Erreur 6 : Agr√©gation casse le site

**Sympt√¥me** : Site fonctionne en dev mais casse en production

**Cause** : Ordre de chargement chang√© avec l'agr√©gation

**Solution** :
```yaml
# Utiliser weight pour contr√¥ler l'ordre
my-library:
  js:
    js/init.js:
      weight: -10   # Charge en premier
    js/main.js:
      weight: 0     # Charge apr√®s
```

```bash
# Tester avec agr√©gation activ√©e localement
drush config:set system.performance js.preprocess true -y
drush cr
```

<Aside type="tip" title="D√©bogage avanc√©">
**Module Devel** : Affiche les librairies charg√©es sur chaque page

```bash
composer require --dev drupal/devel
drush pm:enable devel
```

En bas de page, cliquez sur l'onglet "Devel" pour voir toutes les librairies actives.
</Aside>

## üìö Ressources compl√©mentaires

### Documentation officielle

- [Asset Libraries](https://www.drupal.org/docs/theming-drupal/adding-assets-css-js-to-a-drupal-theme) - Guide complet
- [JavaScript API](https://www.drupal.org/docs/develop/standards/javascript/javascript-api-overview) - Drupal.behaviors, once
- [Library Definitions](https://www.drupal.org/node/2274843) - Format .libraries.yml
- [Aggregation](https://www.drupal.org/docs/administering-a-drupal-site/optimizing-performance) - Optimisation

### Outils recommand√©s

- **Vite** : Bundler moderne ultra-rapide (utilis√© dans ce projet)
- **PostCSS** : Transformations CSS (autoprefixer, etc.)
- **ESLint** : Linter JavaScript
- **Stylelint** : Linter CSS
- **Prettier** : Formateur de code automatique

### Exemples de code

- [Drupal Core Libraries](https://git.drupalcode.org/project/drupal/-/blob/11.x/core/core.libraries.yml) - Exemples officiels
- [Olivero Libraries](https://git.drupalcode.org/project/drupal/-/blob/11.x/core/themes/olivero/olivero.libraries.yml) - Th√®me moderne

## ‚úÖ Checklist

- [ ] Librairie `global` d√©clar√©e et attach√©e
- [ ] CSS organis√©s par cat√©gories
- [ ] JavaScript avec Drupal.behaviors
- [ ] D√©pendances correctement d√©clar√©es
- [ ] Librairies externes (CDN) configur√©es
- [ ] drupalSettings utilis√© si n√©cessaire
- [ ] Librairies test√©es en dev et prod

## üîú Prochaine √©tape

Les assets sont configur√©s ! Passons √† l'int√©gration de [Tailwind CSS](/etape-6-theming/tailwind/).
