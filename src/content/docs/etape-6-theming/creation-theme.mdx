---
title: CrÃ©er un thÃ¨me
description: Structure et fichiers de base d'un thÃ¨me Drupal personnalisÃ©
sidebar:
  order: 1

# status: stable
# last-reviewed: 2026-01-14
---

import { Tabs, TabItem, Aside, Steps, FileTree } from '@astrojs/starlight/components';

## ğŸ¨ Qu'est-ce qu'un thÃ¨me Drupal ?

Un **thÃ¨me Drupal** est un ensemble de fichiers qui contrÃ´le l'apparence visuelle de votre site. Il transforme les donnÃ©es brutes (contenu, menus, blocs) en HTML, CSS et JavaScript pour le navigateur.

### Architecture en couches

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Contenu (Drupal Core)           â”‚ â† DonnÃ©es, logique mÃ©tier, base de donnÃ©es
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     ThÃ¨me (Twig + CSS + JS)         â”‚ â† PrÃ©sentation, UX, design
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Navigateur (HTML rendu)         â”‚ â† Affichage final pour l'utilisateur
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ThÃ¨me vs Module

| Aspect | ThÃ¨me | Module |
|--------|-------|--------|
| **RÃ´le** | PrÃ©sentation, affichage | Logique mÃ©tier, fonctionnalitÃ©s |
| **Fichiers** | `.twig`, `.css`, `.js` | `.php`, `.module`, `.routing.yml` |
| **Exemples** | Couleurs, grilles, animations | Types de contenu, API, formulaires |
| **Localisation** | `themes/custom/` | `modules/custom/` |
| **Modifie** | Comment les choses apparaissent | Ce que les choses font |

**Pour TailStore** : Le thÃ¨me gÃ¨re l'apparence e-commerce (grilles produits, panier visuel, animations), tandis que les modules Drupal Commerce gÃ¨rent la logique (prix, stock, commandes, paiement).

### HÃ©ritage des thÃ¨mes

```
core/themes/stable9/  (base Drupal)
        â†“
themes/custom/tailstore/  (votre thÃ¨me)
```

**Deux options** :
1. **`base theme: false`** : ThÃ¨me indÃ©pendant (contrÃ´le total, plus de travail)
2. **`base theme: olivero`** : HÃ©rite d'un thÃ¨me existant (rapide, moins flexible)

**Choix pour TailStore** : `base theme: false` car nous crÃ©ons un design e-commerce sur-mesure avec Tailwind CSS.

## ğŸ“ Emplacement des thÃ¨mes

Les thÃ¨mes personnalisÃ©s se placent dans :

```
drupal/
â”œâ”€â”€ core/
â”‚   â””â”€â”€ themes/           # ThÃ¨mes du core (ne pas modifier)
â”‚       â”œâ”€â”€ olivero/
â”‚       â”œâ”€â”€ claro/
â”‚       â””â”€â”€ stark/
â”œâ”€â”€ themes/
â”‚   â””â”€â”€ custom/           # Vos thÃ¨mes personnalisÃ©s
â”‚       â””â”€â”€ tailstore/    # Notre thÃ¨me
â””â”€â”€ sites/
```

## ğŸ—ï¸ CrÃ©er la structure

<Steps>

1. CrÃ©ez le dossier du thÃ¨me

    ```bash
    mkdir -p themes/custom/tailstore
    cd themes/custom/tailstore
    ```

2. CrÃ©ez les sous-dossiers

    ```bash
    mkdir -p css/{base,components,layout}
    mkdir -p js
    mkdir -p images
    mkdir -p templates/{layout,block,node,field,views,misc}
    mkdir -p config/install
    ```

</Steps>

### Structure finale

<FileTree>
- tailstore/
  - tailstore.info.yml
  - tailstore.libraries.yml
  - tailstore.theme
  - tailstore.breakpoints.yml
  - css/
    - base/
    - components/
    - layout/
    - tailstore.css
  - js/
    - tailstore.js
  - images/
    - logo.svg
  - templates/
    - layout/
    - block/
    - node/
    - field/
    - views/
    - misc/
</FileTree>

## ğŸ“„ Fichier .info.yml

Le fichier **tailstore.info.yml** est obligatoire et dÃ©clare le thÃ¨me :

```yaml
# tailstore.info.yml
name: TailStore
type: theme
description: 'ThÃ¨me e-commerce moderne pour la boutique TailStore'
package: Custom
core_version_requirement: ^10 || ^11

# ThÃ¨me parent (hÃ©ritage)
base theme: false
# Ou hÃ©riter d'un thÃ¨me : base theme: olivero

# Logo et screenshot
logo: images/logo.svg
screenshot: screenshot.png

# RÃ©gions du thÃ¨me (zones de placement des blocs)
regions:
  header: 'Header'
  primary_menu: 'Primary menu'
  secondary_menu: 'Secondary menu'
  highlighted: 'Highlighted'
  help: 'Help'
  breadcrumb: 'Breadcrumb'
  content: 'Content'
  sidebar: 'Sidebar'
  content_below: 'Content below'
  footer_top: 'Footer top'
  footer_bottom: 'Footer bottom'

# Librairies attachÃ©es globalement
libraries:
  - tailstore/global

# Formulaires de configuration du thÃ¨me
ckeditor5-stylesheets:
  - css/ckeditor.css

# Configuration par dÃ©faut
libraries-override: {}
libraries-extend: {}
```

<Aside type="tip" title="core_version_requirement">
Utilisez `^10 || ^11` pour supporter Drupal 10 et 11.
</Aside>

### ğŸ“ Comprendre les rÃ©gions

Les **rÃ©gions** dÃ©finissent les zones oÃ¹ vous pouvez placer des blocs. Voici comment elles s'organisent visuellement :

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  header                         â”‚ â† Logo, recherche, langues
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  primary_menu           â”‚  secondary_menu      â”‚ â† Navigation principale/secondaire
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              highlighted                        â”‚ â† Messages systÃ¨me, bandeau promo
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              breadcrumb                         â”‚ â† Fil d'Ariane
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                           â”‚                    â”‚
â”‚         content           â”‚      sidebar       â”‚ â† Contenu principal + filtres/widgets
â”‚        (obligatoire)      â”‚                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚             content_below                       â”‚ â† Produits recommandÃ©s, newsletter
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚              footer_top                         â”‚ â† Liens, rÃ©seaux sociaux
â”‚              footer_bottom                      â”‚ â† Copyright, mentions lÃ©gales
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

<Aside type="caution" title="RÃ©gion 'content' obligatoire">
La rÃ©gion **`content`** est obligatoire dans tous les thÃ¨mes Drupal. C'est lÃ  que le contenu principal de la page sera affichÃ©.
</Aside>

### ğŸ›’ RÃ©gions spÃ©cifiques e-commerce

Pour le projet **TailStore**, nous ajouterons des rÃ©gions supplÃ©mentaires adaptÃ©es Ã  l'e-commerce. Modifiez la section `regions:` pour inclure :

```yaml
regions:
  # RÃ©gions standards
  header: 'Header'
  cart_header: 'Cart icon & counter'
  primary_menu: 'Primary menu'
  secondary_menu: 'Secondary menu'
  promo_banner: 'Promotional banner'
  highlighted: 'Highlighted'
  help: 'Help'
  breadcrumb: 'Breadcrumb'
  
  # Zones de contenu
  content: 'Content'
  sidebar: 'Sidebar (filters, widgets)'
  content_below: 'Content below (recommendations)'
  
  # Footer
  footer_top: 'Footer top'
  footer_bottom: 'Footer bottom'
  trust_badges: 'Trust badges (checkout)'
```

**Utilisation des nouvelles rÃ©gions** :
- **`cart_header`** : IcÃ´ne panier avec compteur d'articles (dynamique)
- **`promo_banner`** : Bandeau promotionnel (ex: "Livraison gratuite dÃ¨s 50â‚¬")
- **`sidebar`** : Filtres de prix, catÃ©gories, disponibilitÃ© sur les pages catalogue
- **`content_below`** : "Vous aimerez aussi", cross-sell, upsell
- **`trust_badges`** : Badges de rÃ©assurance (paiement sÃ©curisÃ©, satisfait ou remboursÃ©)

## ğŸ“š Fichier .libraries.yml

Le fichier **tailstore.libraries.yml** dÃ©clare les CSS et JS selon les standards Drupal :

<Tabs>
  <TabItem label="Exemple complet">

```yaml
# tailstore.libraries.yml

# Librairie globale (chargÃ©e sur toutes les pages)
global:
  version: 1.0.0
  css:
    base:
      css/base/reset.css: {}
      css/base/typography.css: {}
    layout:
      css/layout/grid.css: {}
      css/layout/regions.css: {}
    component:
      css/components/buttons.css: {}
      css/components/cards.css: {}
      css/components/forms.css: {}
      css/components/navigation.css: {}
    theme:
      css/tailstore.css: {}
  js:
    js/tailstore.js: {}
  dependencies:
    - core/drupal
    - core/once

# Librairie spÃ©cifique pour le slider
slider:
  version: 1.0.0
  css:
    component:
      css/components/slider.css: {}
  js:
    js/slider.js: {}
  dependencies:
    - tailstore/global
    - core/once

# Librairie pour le panier avec drupalSettings
cart:
  version: 1.0.0
  js:
    js/cart.js: { attributes: { defer: true } }
  dependencies:
    - tailstore/global
    - core/drupalSettings

# CDN externes (Swiper)
swiper:
  version: 11.0.0
  remote: https://swiperjs.com/
  license:
    name: MIT
    url: https://github.com/nolimits4web/swiper/blob/master/LICENSE
    gpl-compatible: true
  css:
    theme:
      https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css: { type: external, minified: true }
  js:
    https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js: { type: external, minified: true }

# Alpine.js avec attributs
alpine:
  version: 3.14.1
  remote: https://alpinejs.dev/
  license:
    name: MIT
    url: https://github.com/alpinejs/alpine/blob/main/LICENSE.md
    gpl-compatible: true
  js:
    https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js: { type: external, attributes: { defer: true } }

# Librairie chargÃ©e dans le header (ex: polices)
fonts:
  version: 1.0.0
  header: true
  css:
    theme:
      https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap: { type: external }

# Librairie avec JS non agrÃ©gÃ©
analytics:
  version: 1.0.0
  js:
    js/analytics.js: { preprocess: false }
  dependencies:
    - core/drupal
```

  </TabItem>
  <TabItem label="Types CSS">

```yaml
# Types de CSS avec leurs poids de chargement
example:
  css:
    # Poids CSS_BASE = -200 : Reset, normalisation HTML
    base:
      css/base/reset.css: {}
      css/base/normalize.css: {}
    
    # Poids CSS_LAYOUT = -100 : Structure, grille, rÃ©gions
    layout:
      css/layout/grid.css: {}
      css/layout/regions.css: {}
    
    # Poids CSS_COMPONENT = 0 : Composants individuels
    component:
      css/components/buttons.css: {}
      css/components/cards.css: {}
      css/components/forms.css: {}
    
    # Poids CSS_STATE = 100 : Ã‰tats (hover, active, focus)
    state:
      css/state/states.css: {}
    
    # Poids CSS_THEME = 200 : Styles finaux, surcharges
    theme:
      css/theme/colors.css: {}
      css/theme/custom.css: {}
```

  </TabItem>
  <TabItem label="Options JS">

```yaml
# Options avancÃ©es pour JavaScript
advanced-js:
  js:
    # JS chargÃ© dans le <head>
    js/header-script.js: { header: true }
    
    # JS dÃ©jÃ  minifiÃ© (Ã©vite la minification Drupal)
    js/minified.js: { minified: true }
    
    # Attributs personnalisÃ©s
    js/custom.js: { 
      attributes: { 
        id: "custom-script",
        "data-version": "1.0"
      } 
    }
    
    # JS non agrÃ©gÃ©
    js/no-aggregate.js: { preprocess: false }
```

  </TabItem>
</Tabs>

<Aside type="tip" title="Version obligatoire">
Depuis Drupal 10.1.2, la clÃ© `version` est obligatoire dans chaque librairie pour Ã©viter les problÃ¨mes de cache.
</Aside>

## ğŸŸ¨ JavaScript dans Drupal

### Structure recommandÃ©e : IIFE + Drupal.behaviors

Les fichiers JavaScript Drupal utilisent une structure spÃ©cifique appelÃ©e **IIFE** (Immediately Invoked Function Expression) combinÃ©e avec `Drupal.behaviors`.

<Tabs>
  <TabItem label="Syntaxe de base">

```javascript
// Fonction anonyme classique
function() {
  console.log('Hello World!');
}

// Devient une IIFE
(function() {
  console.log('Hello World!');
})();
```

  </TabItem>
  <TabItem label="Avec paramÃ¨tres">

```javascript
// IIFE avec paramÃ¨tres (injection de dÃ©pendances)
(function($, Drupal, once) {
  'use strict';
  
  // Code protÃ©gÃ© dans la portÃ©e locale
  Drupal.behaviors.myBehavior = {
    attach: function(context, settings) {
      // Votre code ici
    }
  };
  
})(jQuery, Drupal, once);
```

  </TabItem>
  <TabItem label="Dans Drupal">

```javascript
// js/tailstore.js - Exemple complet
(function($, Drupal, once) {
  'use strict';
  
  // Comportement pour le menu mobile
  Drupal.behaviors.tailstoreMobileMenu = {
    attach: function(context, settings) {
      once('mobile-menu', '.mobile-menu-toggle', context).forEach(function(element) {
        $(element).on('click', function() {
          $('.main-navigation').toggleClass('is-open');
        });
      });
    }
  };
  
  // Comportement pour les sliders
  Drupal.behaviors.tailstoreSliders = {
    attach: function(context, settings) {
      once('product-slider', '.product-slider', context).forEach(function(element) {
        // Initialisation du slider
        new Swiper(element, {
          slidesPerView: 1,
          spaceBetween: 10,
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      });
    }
  };
  
})(jQuery, Drupal, once);
```

  </TabItem>
</Tabs>

### Pourquoi cette structure ?

<Aside type="tip" title="Avantages de l'IIFE + Drupal.behaviors">
- **PortÃ©e isolÃ©e** : Variables locales, pas de pollution globale
- **Compatible AJAX** : `Drupal.behaviors` se rÃ©exÃ©cute aprÃ¨s les requÃªtes AJAX
- **Compatible BigPipe** : Fonctionne avec le chargement progressif Drupal
- **API once()** : Ã‰vite la rÃ©initialisation multiple des Ã©lÃ©ments
- **Injection de dÃ©pendances** : `jQuery`, `Drupal`, `once` passÃ©s explicitement
</Aside>

### Exemple minimal pour TailStore

```javascript
// js/tailstore.js
(function($, Drupal, once) {
  'use strict';
  
  // Menu mobile toggle
  Drupal.behaviors.tailstoreMobileMenu = {
    attach: function(context, settings) {
      once('mobile-menu', '.mobile-menu-toggle', context).forEach(function(toggle) {
        $(toggle).on('click', function(e) {
          e.preventDefault();
          $('.main-navigation').toggleClass('is-open');
        });
      });
    }
  };
  
})(jQuery, Drupal, once);
```

<Aside type="note" title="Approfondir JavaScript Drupal">
Pour une explication dÃ©taillÃ©e des IIFE, `Drupal.behaviors`, et l'API `once`, consultez :
- [Documentation officielle Drupal JavaScript](https://www.drupal.org/docs/develop/standards/javascript/javascript-api-overview)
- [Once API (Drupal 10+)](https://www.drupal.org/node/3158256)

Nous approfondirons ces concepts dans le chapitre **Alpine.js** oÃ¹ nous crÃ©erons des interactions avancÃ©es.
</Aside>

## ğŸ˜ Fichier .theme

Le fichier **tailstore.theme** contient les fonctions PHP qui utilisent le **systÃ¨me de hooks** de Drupal.

### Qu'est-ce qu'un hook Drupal ?

Un **hook** est un point d'extension dans Drupal qui permet aux modules et thÃ¨mes de modifier ou d'Ã©tendre le comportement du systÃ¨me. Les hooks sont des fonctions PHP nommÃ©es selon une convention spÃ©cifique : `nom_du_module_ou_theme_nom_du_hook()`.

<Tabs>
  <TabItem label="Types de hooks utilisÃ©s">

```php
// Hook de prÃ©processing : Modifie les variables avant le rendu
hook_preprocess_HOOK(&$variables)

// Hook d'altÃ©ration de formulaire : Modifie les formulaires
hook_form_alter(&$form, $form_state, $form_id)

// Hook de suggestions de template : Ajoute des templates alternatifs
hook_theme_suggestions_HOOK_alter(&$suggestions, $variables)
```

  </TabItem>
  <TabItem label="Convention de nommage">

```php
// Pour un thÃ¨me nommÃ© "tailstore" :
// hook_preprocess_page â†’ tailstore_preprocess_page
// hook_form_alter â†’ tailstore_form_alter
// hook_theme_suggestions_node_alter â†’ tailstore_theme_suggestions_node_alter

function tailstore_preprocess_page(&$variables) {
  // Votre code ici
}
```

  </TabItem>
</Tabs>

<Aside type="tip" title="RÃ´le des hooks dans les thÃ¨mes">
- **PrÃ©processing** : PrÃ©parer/modifier les donnÃ©es avant l'affichage
- **AltÃ©ration** : Modifier les formulaires et leur comportement  
- **Suggestions** : Proposer des templates alternatifs selon le contexte
</Aside>

<Aside type="note" title="Ressources officielles">
Pour une liste complÃ¨te des hooks disponibles dans Drupal, consultez :
- [Documentation des hooks Drupal](https://www.drupal.org/node/3551652)
- [API Drupal - Hooks (v11.x)](https://api.drupal.org/api/drupal/core!core.api.php/group/hooks/11.x)

**Ã‰volution des hooks dans Drupal 11 :**
- [Nouveaux hooks avec attributs vs hooks procÃ©duraux](https://dev.to/xwero/new-drupal-hook-attribute-34n0)
</Aside>

Le fichier **tailstore.theme** contient les fonctions PHP :

```php
<?php

/**
 * @file
 * Functions to support theming in the TailStore theme.
 */

use Drupal\Core\Form\FormStateInterface;

/**
 * Implements hook_preprocess_HOOK() for html.html.twig.
 *
 * Ce hook permet de modifier les variables avant le rendu du template html.html.twig.
 * Ici, on ajoute des classes CSS au body pour le styling et la logique conditionnelle.
 */
function tailstore_preprocess_html(&$variables) {
  // Ajouter une classe globale au thÃ¨me
  $variables['attributes']['class'][] = 'tailstore-theme';
  
  // Ajouter une classe spÃ©cifique pour les pages produit
  // Utile pour appliquer des styles particuliers aux pages e-commerce
  $node = \Drupal::routeMatch()->getParameter('node');
  if ($node && $node->bundle() === 'product') {
    $variables['attributes']['class'][] = 'page-product';
  }
}

## ğŸ§  Bonnes pratiques essentielles

### ğŸ”’ SÃ©curitÃ© : Validation des donnÃ©es

Ne jamais faire confiance aux donnÃ©es utilisateur ou mÃªme aux champs Drupal sans validation.

**âŒ Dangereux** :
```php
function tailstore_preprocess_node(&$variables) {
  $node = $variables['node'];
  $variables['price'] = $node->get('field_price')->value; // Pas de validation !
}
```

**âœ… SÃ©curisÃ©** :
```php
function tailstore_preprocess_node(&$variables) {
  $node = $variables['node'];
  
  if ($node->hasField('field_price') && !$node->get('field_price')->isEmpty()) {
    $price = $node->get('field_price')->value;
    
    // Valider que c'est un nombre positif
    if (is_numeric($price) && $price >= 0) {
      $variables['price'] = number_format((float) $price, 2, ',', ' ') . ' â‚¬';
    }
    else {
      // Logger l'erreur
      \Drupal::logger('tailstore')->warning('Invalid price for node @nid', [
        '@nid' => $node->id()
      ]);
    }
  }
}
```

<Aside type="caution" title="Toujours valider les donnÃ©es">
Toujours vÃ©rifier l'existence des champs, leur contenu, et valider les types de donnÃ©es avant utilisation.
</Aside>

### âš¡ Performance : Chargement conditionnel

**Principe** : Ã‰vitez de charger des librairies lourdes sur toutes les pages.

**Exemple** : Charger le slider uniquement sur la homepage :

```php
function tailstore_preprocess_page(&$variables) {
  // Slider chargÃ© UNIQUEMENT sur la homepage
  if (\Drupal::service('path.matcher')->isFrontPage()) {
    $variables['#attached']['library'][] = 'tailstore/slider';
    $variables['#attached']['library'][] = 'tailstore/swiper';
  }
  
  // Panier chargÃ© UNIQUEMENT sur les pages produit et panier
  $route_name = \Drupal::routeMatch()->getRouteName();
  if (in_array($route_name, ['entity.node.canonical', 'commerce_cart.page'])) {
    $variables['#attached']['library'][] = 'tailstore/cart';
  }
}
```

**Impact** :
- Homepage : 200KB JS
- Page article : 50KB JS (150KB Ã©conomisÃ©s !)

<Aside type="tip" title="Chargement conditionnel obligatoire">
Ne jamais charger des librairies lourdes (sliders, animations) sur toutes les pages. Utilisez les hooks de preprocessing pour un chargement ciblÃ©.
</Aside>

### â™¿ AccessibilitÃ© : RÃ©gions et landmarks

<Aside type="note" title="RÃ©gions doivent correspondre Ã  des landmarks HTML5">
Chaque rÃ©gion Drupal doit Ãªtre rendue avec le landmark HTML5 appropriÃ© dans les templates Twig.

| RÃ©gion Drupal | Landmark HTML5 | RÃ´le ARIA | Utilisation |
|---------------|----------------|-----------|-------------|
| `header` | `<header>` | `role="banner"` | En-tÃªte principal (logo, recherche) |
| `primary_menu` | `<nav>` | `role="navigation"` | Navigation principale |
| `content` | `<main>` | `role="main"` | Contenu principal (unique par page) |
| `sidebar` | `<aside>` | `role="complementary"` | Contenu complÃ©mentaire (filtres, widgets) |
| `footer_top` | `<footer>` | `role="contentinfo"` | Pied de page |

**ImplÃ©mentation** : Cela sera fait dans les templates Twig (chapitre suivant).

**Test d'accessibilitÃ©** :
- Extension : [axe DevTools](https://www.deque.com/axe/devtools/)
- Lecteur d'Ã©cran : NVDA (Windows), VoiceOver (Mac)
- Validation : [WAVE](https://wave.webaim.org/)
</Aside>

### ğŸ“– Documentation : PHPDoc obligatoire

Chaque hook doit avoir un bloc de documentation PHPDoc.

**Template recommandÃ©** :
```php
/**
 * Implements hook_preprocess_HOOK() for node.html.twig.
 *
 * Prepare variables for node templates.
 *
 * @param array $variables
 *   An associative array containing:
 *   - elements: Node entity and view mode.
 *   - node: The node entity.
 *   - view_mode: View mode (full, teaser, card, etc.).
 */
function tailstore_preprocess_node(&$variables) {
  // Code...
}
```

<Aside type="tip" title="Documentation obligatoire">
**Avantages** :
- ComprÃ©hension rapide du rÃ´le
- Auto-documentation du code
- Support IDE (autocomplÃ©tion PHPStorm, VS Code)
</Aside>

Le fichier **tailstore.theme** contient les fonctions PHP :

```php
<?php

/**
 * @file
 * Functions to support theming in the TailStore theme.
 */

use Drupal\Core\Form\FormStateInterface;

/**
 * Implements hook_preprocess_HOOK() for html.html.twig.
 *
 * Ce hook permet de modifier les variables avant le rendu du template html.html.twig.
 * Ici, on ajoute des classes CSS au body pour le styling et la logique conditionnelle.
 */
function tailstore_preprocess_html(&$variables) {
  // Ajouter une classe globale au thÃ¨me
  $variables['attributes']['class'][] = 'tailstore-theme';
  
  // Ajouter une classe spÃ©cifique pour les pages produit
  // Utile pour appliquer des styles particuliers aux pages e-commerce
  $node = \Drupal::routeMatch()->getParameter('node');
  if ($node && $node->bundle() === 'product') {
    $variables['attributes']['class'][] = 'page-product';
  }
}

/**
 * Implements hook_preprocess_HOOK() for page.html.twig.
 *
 * Ce hook permet de modifier les variables avant le rendu du template page.html.twig.
 * Ici, on charge des librairies JavaScript selon le contexte de la page.
 */
function tailstore_preprocess_page(&$variables) {
  // Charger la librairie slider uniquement sur la page d'accueil
  // Ã‰vite de charger du JS inutile sur les autres pages
  if (\Drupal::service('path.matcher')->isFrontPage()) {
    $variables['#attached']['library'][] = 'tailstore/slider';
    $variables['#attached']['library'][] = 'tailstore/swiper';
  }
}

/**
 * Implements hook_preprocess_HOOK() for node.html.twig.
 *
 * Ce hook permet de modifier les variables avant le rendu des nodes.
 * Ici, on prÃ©pare des donnÃ©es spÃ©cifiques pour les produits e-commerce.
 */
function tailstore_preprocess_node(&$variables) {
  /** @var \Drupal\node\NodeInterface $node */
  $node = $variables['node'];
  
  // Variables personnalisÃ©es pour les produits
  if ($node->bundle() === 'product') {
    // Formater le prix avec sÃ©parateur franÃ§ais
    if ($node->hasField('field_price') && !$node->get('field_price')->isEmpty()) {
      $variables['formatted_price'] = number_format(
        $node->get('field_price')->value,
        2,
        ',',
        ' '
      ) . ' â‚¬';
    }
    
    // VÃ©rifier la disponibilitÃ© en stock
    if ($node->hasField('field_stock')) {
      $variables['in_stock'] = $node->get('field_stock')->value > 0;
    }
    
    // Gestion des prix barrÃ©s pour les promotions
    if ($node->hasField('field_old_price') && !$node->get('field_old_price')->isEmpty()) {
      $variables['old_price'] = number_format(
        $node->get('field_old_price')->value,
        2,
        ',',
        ' '
      ) . ' â‚¬';
      $variables['is_on_sale'] = TRUE;
    }
  }
}

/**
 * Implements hook_preprocess_HOOK() for field.html.twig.
 *
 * Ce hook permet de modifier les variables avant le rendu des champs.
 * Ici, on ajoute des classes CSS spÃ©cifiques selon le type de champ.
 */
function tailstore_preprocess_field(&$variables) {
  $field_name = $variables['field_name'];
  
  // Ajouter une classe spÃ©cifique pour le prix
  if ($field_name === 'field_price') {
    $variables['attributes']['class'][] = 'product-price';
  }
}

/**
 * Implements hook_form_alter().
 *
 * Ce hook permet de modifier tous les formulaires du systÃ¨me.
 * Ici, on personnalise l'apparence et le comportement de certains formulaires.
 */
function tailstore_form_alter(&$form, FormStateInterface $form_state, $form_id) {
  // Personnaliser le formulaire de recherche
  if ($form_id === 'search_block_form') {
    $form['keys']['#attributes']['placeholder'] = t('Rechercher...');
    $form['keys']['#attributes']['class'][] = 'search-input';
  }
  
  // Personnaliser les filtres exposÃ©s des vues
  if (strpos($form_id, 'views_exposed_form') === 0) {
    $form['#attributes']['class'][] = 'filters-form';
  }
}

/**
 * Implements hook_theme_suggestions_HOOK_alter() for node.
 *
 * Ce hook permet de suggÃ©rer des templates alternatifs selon le contexte.
 * Ici, on propose des templates spÃ©cifiques pour les produits en promotion.
 */
function tailstore_theme_suggestions_node_alter(array &$suggestions, array $variables) {
  /** @var \Drupal\node\NodeInterface $node */
  $node = $variables['elements']['#node'];
  $view_mode = $variables['elements']['#view_mode'];
  
  // Ajouter une suggestion basÃ©e sur un champ personnalisÃ©
  if ($node->bundle() === 'product' && $node->hasField('field_featured')) {
    if ($node->get('field_featured')->value) {
      $suggestions[] = 'node__product__featured';
      $suggestions[] = 'node__product__' . $view_mode . '__featured';
    }
  }
}
```
```

## ğŸ“ Fichier .breakpoints.yml

Le fichier **tailstore.breakpoints.yml** dÃ©finit les points de rupture responsive :

```yaml
# tailstore.breakpoints.yml

tailstore.mobile:
  label: Mobile
  mediaQuery: ''
  weight: 0
  multipliers:
    - 1x
    - 2x

tailstore.narrow:
  label: Narrow
  mediaQuery: 'all and (min-width: 560px)'
  weight: 1
  multipliers:
    - 1x
    - 2x

tailstore.medium:
  label: Medium
  mediaQuery: 'all and (min-width: 768px)'
  weight: 2
  multipliers:
    - 1x
    - 2x

tailstore.wide:
  label: Wide
  mediaQuery: 'all and (min-width: 1024px)'
  weight: 3
  multipliers:
    - 1x
    - 2x

tailstore.extra_wide:
  label: Extra Wide
  mediaQuery: 'all and (min-width: 1280px)'
  weight: 4
  multipliers:
    - 1x
    - 2x
```

<Aside type="tip" title="Module requis">
Pour utiliser les breakpoints dÃ©finis dans `tailstore.breakpoints.yml`, vous devez activer le module **Breakpoint** du core Drupal :

```bash
# Via Drush
drush pm:enable breakpoint -y

# Ou via l'interface : Administration > Extend > Core > Breakpoint
```
</Aside>

## âœ… Activer le thÃ¨me

### Via l'interface

1. **Appearance** (`/admin/appearance`)
2. Trouvez "TailStore" dans la liste
3. Cliquez sur **Install and set as default**

### Via Drush

```bash
# Activer le thÃ¨me
drush theme:enable tailstore

# DÃ©finir comme thÃ¨me par dÃ©faut
drush config:set system.theme default tailstore -y

# Vider le cache
drush cr
```

## ğŸ¨ CSS de base

### css/base/reset.css

```css
/* Reset moderne */
*,
*::before,
*::after {
  box-sizing: border-box;
}

* {
  margin: 0;
  padding: 0;
}

html {
  font-size: 16px;
  scroll-behavior: smooth;
}

body {
  line-height: 1.5;
  -webkit-font-smoothing: antialiased;
}

img,
picture,
video,
canvas,
svg {
  display: block;
  max-width: 100%;
}

input,
button,
textarea,
select {
  font: inherit;
}

p,
h1,
h2,
h3,
h4,
h5,
h6 {
  overflow-wrap: break-word;
}
```

### css/base/typography.css

```css
/* Variables de typographie */
:root {
  --font-sans: 'Inter', system-ui, -apple-system, sans-serif;
  --font-mono: 'Fira Code', monospace;
  
  --text-xs: 0.75rem;
  --text-sm: 0.875rem;
  --text-base: 1rem;
  --text-lg: 1.125rem;
  --text-xl: 1.25rem;
  --text-2xl: 1.5rem;
  --text-3xl: 2rem;
  --text-4xl: 2.5rem;
}

body {
  font-family: var(--font-sans);
  font-size: var(--text-base);
  color: var(--color-dark, #1a1a2e);
}

h1, h2, h3, h4, h5, h6 {
  font-weight: 600;
  line-height: 1.2;
}

h1 { font-size: var(--text-4xl); }
h2 { font-size: var(--text-3xl); }
h3 { font-size: var(--text-2xl); }
h4 { font-size: var(--text-xl); }

a {
  color: var(--color-primary, #0073e6);
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}
```

## ğŸ–¼ï¸ Logo

Placez votre logo dans `images/logo.svg` ou configurez-le via :

1. **Appearance** â†’ **Settings** â†’ **TailStore**
2. Section **Logo image**
3. Uploadez ou spÃ©cifiez le chemin

## ğŸ’¾ VÃ©rifier l'installation

```bash
# VÃ©rifier que le thÃ¨me est actif
drush config:get system.theme default

# Devrait retourner : 'tailstore'

# Vider le cache
drush cr

# Visitez le site pour voir le thÃ¨me
```

### âœ… Checkpoint : ThÃ¨me activÃ© et fonctionnel

VÃ©rifiez que tout fonctionne correctement :

<Steps>

1. **VÃ©rifier l'activation**
   ```bash
   drush config:get system.theme default
   ```
   **Attendu** : `'system.theme:default': tailstore`

2. **VÃ©rifier les logs d'erreurs**
   ```bash
   drush watchdog:show --severity=Error --count=10
   ```
   **Attendu** : Aucune erreur liÃ©e au thÃ¨me

3. **Tester l'accessibilitÃ© du site**
   ```bash
   curl -I http://localhost/
   ```
   **Attendu** : `HTTP/1.1 200 OK`

4. **Inspecter le HTML dans le navigateur**
   - Ouvrez le site dans votre navigateur
   - F12 â†’ Onglet Elements
   - VÃ©rifiez que `<body>` contient `class="tailstore-theme"`

5. **VÃ©rifier le chargement CSS/JS**
   - F12 â†’ Onglet Network
   - Rechargez la page
   - VÃ©rifiez que `tailstore.css` et `tailstore.js` sont chargÃ©s (statut 200)

</Steps>

<Aside type="caution" title="DÃ©pannage">
**Si le site affiche une page blanche** :
- VÃ©rifiez la syntaxe YAML (pas de tabulations, espaces uniquement)
- Consultez les logs PHP : `tail -f sites/default/files/php-errors.log`
- DÃ©sactivez temporairement le thÃ¨me : `drush config:set system.theme default olivero -y`

**Si les CSS ne se chargent pas** :
- VÃ©rifiez les chemins dans `tailstore.libraries.yml`
- Videz le cache : `drush cr`
- DÃ©sactivez l'agrÃ©gation CSS : `/admin/config/development/performance`
</Aside>

## ğŸ¯ Exercices pratiques

### Exercice 1 : CrÃ©er le thÃ¨me minimal

**Objectif** : CrÃ©er un thÃ¨me fonctionnel avec seulement les fichiers obligatoires.

<Steps>

1. CrÃ©ez la structure minimale :
   ```bash
   mkdir -p themes/custom/tailstore
   cd themes/custom/tailstore
   touch tailstore.info.yml
   ```

2. Ã‰ditez `tailstore.info.yml` avec le strict minimum :
   ```yaml
   name: TailStore
   type: theme
   core_version_requirement: ^10 || ^11
   regions:
     content: 'Content'
   ```

3. Activez le thÃ¨me :
   ```bash
   drush theme:enable tailstore
   drush config:set system.theme default tailstore -y
   drush cr
   ```

4. Visitez votre site : il doit s'afficher (mÃªme sans style)

</Steps>

**Validation** : âœ… Le site est accessible sans erreur 500

---

### Exercice 2 : Premier hook de preprocessing

**Objectif** : Ajouter une classe CSS personnalisÃ©e au `<body>`.

<Steps>

1. CrÃ©ez le fichier `tailstore.theme` :
   ```bash
   touch tailstore.theme
   ```

2. Ajoutez ce code :
   ```php
   <?php
   
   function tailstore_preprocess_html(&$variables) {
     $variables['attributes']['class'][] = 'tailstore-active';
   }
   ```

3. Videz le cache :
   ```bash
   drush cr
   ```

4. Inspectez le HTML (F12) : vous devriez voir :
   ```html
   <body class="tailstore-active">
   ```

</Steps>

**Validation** : âœ… La classe `tailstore-active` apparaÃ®t dans le `<body>`

---

### Exercice 3 : Charger un CSS personnalisÃ©

**Objectif** : CrÃ©er et charger un fichier CSS de test.

<Steps>

1. CrÃ©ez la structure CSS :
   ```bash
   mkdir -p css
   ```

2. CrÃ©ez `css/test.css` avec un style visible :
   ```css
   body {
     background-color: #ffe6e6;
     border-top: 5px solid #dc3545;
   }
   ```

3. CrÃ©ez `tailstore.libraries.yml` :
   ```yaml
   global:
     version: 1.0.0
     css:
       theme:
         css/test.css: {}
   ```

4. DÃ©clarez la librairie dans `tailstore.info.yml` :
   ```yaml
   libraries:
     - tailstore/global
   ```

5. Videz le cache et rechargez :
   ```bash
   drush cr
   ```

</Steps>

**Validation** : âœ… Le fond de la page doit Ãªtre rose clair avec une bordure rouge en haut

**Si Ã§a ne fonctionne pas** :
- VÃ©rifiez le chemin dans `libraries.yml` (relatif au dossier du thÃ¨me)
- Inspectez F12 â†’ Network : le fichier `test.css` doit Ãªtre chargÃ© (statut 200)
- VÃ©rifiez la console pour des erreurs 404

---

### Exercice 4 : Ajouter les rÃ©gions e-commerce

**Objectif** : Personnaliser les rÃ©gions pour le projet TailStore.

<Steps>

1. Modifiez la section `regions:` dans `tailstore.info.yml` pour ajouter :
   ```yaml
   regions:
     header: 'Header'
     cart_header: 'Cart icon'
     primary_menu: 'Primary menu'
     content: 'Content'
     sidebar: 'Sidebar'
     footer_top: 'Footer'
   ```

2. Videz le cache :
   ```bash
   drush cr
   ```

3. Allez dans **Structure** â†’ **Block layout** (`/admin/structure/block`)

4. VÃ©rifiez que vos nouvelles rÃ©gions apparaissent

</Steps>

**Validation** : âœ… Les rÃ©gions "Cart icon" et "Sidebar" sont visibles dans la page de placement des blocs

## âœ… Checklist complÃ¨te

| Ã‰tape | Fichier/Action | Statut | Commande de validation |
|-------|----------------|--------|------------------------|
| 1 | CrÃ©er `themes/custom/tailstore/` | â¬œ | `ls themes/custom/tailstore` |
| 2 | `tailstore.info.yml` (minimal) | â¬œ | `drush theme:list \| grep tailstore` |
| 3 | RÃ©gions e-commerce ajoutÃ©es | â¬œ | VÃ©rifier `/admin/structure/block` |
| 4 | `tailstore.libraries.yml` | â¬œ | Valider syntaxe YAML |
| 5 | `tailstore.theme` avec hook | â¬œ | `php -l themes/custom/tailstore/tailstore.theme` |
| 6 | CSS de base (reset, typography) | â¬œ | Inspecter `<head>` (F12) |
| 7 | `tailstore.breakpoints.yml` | â¬œ | `drush pm:enable breakpoint` |
| 8 | Activer le thÃ¨me | â¬œ | `drush config:get system.theme default` |
| 9 | Vider le cache | â¬œ | `drush cr` |
| 10 | Site fonctionnel | â¬œ | Ouvrir dans le navigateur |

**Temps estimÃ© total** : 45 minutes

<Aside type="tip" title="Sauvegarde recommandÃ©e">
Une fois le thÃ¨me fonctionnel, crÃ©ez un snapshot :
```bash
drush sql:dump > backup-theme-fonctionnel.sql
```
</Aside>

## ğŸ”œ Prochaine Ã©tape

Le thÃ¨me est crÃ©Ã© ! Passons aux [Templates Twig](/etape-6-theming/twig/).
