---
title: Cr√©er un th√®me
description: Structure et fichiers de base d'un th√®me Drupal personnalis√©
sidebar:
  order: 1
---

import { Tabs, TabItem, Aside, Steps, FileTree } from '@astrojs/starlight/components';

## üìÅ Emplacement des th√®mes

Les th√®mes personnalis√©s se placent dans :

```
drupal/
‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îî‚îÄ‚îÄ themes/           # Th√®mes du core (ne pas modifier)
‚îÇ       ‚îú‚îÄ‚îÄ olivero/
‚îÇ       ‚îú‚îÄ‚îÄ claro/
‚îÇ       ‚îî‚îÄ‚îÄ stark/
‚îú‚îÄ‚îÄ themes/
‚îÇ   ‚îî‚îÄ‚îÄ custom/           # Vos th√®mes personnalis√©s
‚îÇ       ‚îî‚îÄ‚îÄ tailstore/    # Notre th√®me
‚îî‚îÄ‚îÄ sites/
```

## üèóÔ∏è Cr√©er la structure

<Steps>

1. Cr√©ez le dossier du th√®me

    ```bash
    mkdir -p themes/custom/tailstore
    cd themes/custom/tailstore
    ```

2. Cr√©ez les sous-dossiers

    ```bash
    mkdir -p css/{base,components,layout}
    mkdir -p js
    mkdir -p images
    mkdir -p templates/{layout,block,node,field,views,misc}
    mkdir -p config/install
    ```

</Steps>

### Structure finale

<FileTree>
- tailstore/
  - tailstore.info.yml
  - tailstore.libraries.yml
  - tailstore.theme
  - tailstore.breakpoints.yml
  - css/
    - base/
    - components/
    - layout/
    - tailstore.css
  - js/
    - tailstore.js
  - images/
    - logo.svg
  - templates/
    - layout/
    - block/
    - node/
    - field/
    - views/
    - misc/
</FileTree>

## üìÑ Fichier .info.yml

Le fichier **tailstore.info.yml** est obligatoire et d√©clare le th√®me :

```yaml
# tailstore.info.yml
name: TailStore
type: theme
description: 'Th√®me e-commerce moderne pour la boutique TailStore'
package: Custom
core_version_requirement: ^10 || ^11

# Th√®me parent (h√©ritage)
base theme: false
# Ou h√©riter d'un th√®me : base theme: olivero

# Logo et screenshot
logo: images/logo.svg
screenshot: screenshot.png

# R√©gions du th√®me
regions:
  header: 'Header'
  primary_menu: 'Primary menu'
  secondary_menu: 'Secondary menu'
  highlighted: 'Highlighted'
  help: 'Help'
  breadcrumb: 'Breadcrumb'
  content: 'Content'
  sidebar: 'Sidebar'
  content_below: 'Content below'
  footer_top: 'Footer top'
  footer_bottom: 'Footer bottom'

# Librairies attach√©es globalement
libraries:
  - tailstore/global

# Formulaires de configuration du th√®me
ckeditor5-stylesheets:
  - css/ckeditor.css

# Configuration par d√©faut
libraries-override: {}
libraries-extend: {}
```

<Aside type="tip" title="core_version_requirement">
Utilisez `^10 || ^11` pour supporter Drupal 10 et 11.
</Aside>

## üìö Fichier .libraries.yml

Le fichier **tailstore.libraries.yml** d√©clare les CSS et JS selon les standards Drupal :

<Tabs>
  <TabItem label="Exemple complet">

```yaml
# tailstore.libraries.yml

# Librairie globale (charg√©e sur toutes les pages)
global:
  version: 1.0.0
  css:
    base:
      css/base/reset.css: {}
      css/base/typography.css: {}
    layout:
      css/layout/grid.css: {}
      css/layout/regions.css: {}
    component:
      css/components/buttons.css: {}
      css/components/cards.css: {}
      css/components/forms.css: {}
      css/components/navigation.css: {}
    theme:
      css/tailstore.css: {}
  js:
    js/tailstore.js: {}
  dependencies:
    - core/drupal
    - core/once

# Librairie sp√©cifique pour le slider
slider:
  version: 1.0.0
  css:
    component:
      css/components/slider.css: {}
  js:
    js/slider.js: {}
  dependencies:
    - tailstore/global
    - core/once

# Librairie pour le panier avec drupalSettings
cart:
  version: 1.0.0
  js:
    js/cart.js: { attributes: { defer: true } }
  dependencies:
    - tailstore/global
    - core/drupalSettings

# CDN externes (Swiper)
swiper:
  version: 11.0.0
  remote: https://swiperjs.com/
  license:
    name: MIT
    url: https://github.com/nolimits4web/swiper/blob/master/LICENSE
    gpl-compatible: true
  css:
    theme:
      https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css: { type: external, minified: true }
  js:
    https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js: { type: external, minified: true }

# Alpine.js avec attributs
alpine:
  version: 3.14.1
  remote: https://alpinejs.dev/
  license:
    name: MIT
    url: https://github.com/alpinejs/alpine/blob/main/LICENSE.md
    gpl-compatible: true
  js:
    https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js: { type: external, attributes: { defer: true } }

# Librairie charg√©e dans le header (ex: polices)
fonts:
  version: 1.0.0
  header: true
  css:
    theme:
      https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap: { type: external }

# Librairie avec JS non agr√©g√©
analytics:
  version: 1.0.0
  js:
    js/analytics.js: { preprocess: false }
  dependencies:
    - core/drupal
```

  </TabItem>
  <TabItem label="Types CSS">

```yaml
# Types de CSS avec leurs poids de chargement
example:
  css:
    # Poids CSS_BASE = -200 : Reset, normalisation HTML
    base:
      css/base/reset.css: {}
      css/base/normalize.css: {}
    
    # Poids CSS_LAYOUT = -100 : Structure, grille, r√©gions
    layout:
      css/layout/grid.css: {}
      css/layout/regions.css: {}
    
    # Poids CSS_COMPONENT = 0 : Composants individuels
    component:
      css/components/buttons.css: {}
      css/components/cards.css: {}
      css/components/forms.css: {}
    
    # Poids CSS_STATE = 100 : √âtats (hover, active, focus)
    state:
      css/state/states.css: {}
    
    # Poids CSS_THEME = 200 : Styles finaux, surcharges
    theme:
      css/theme/colors.css: {}
      css/theme/custom.css: {}
```

  </TabItem>
  <TabItem label="Options JS">

```yaml
# Options avanc√©es pour JavaScript
advanced-js:
  js:
    # JS charg√© dans le <head>
    js/header-script.js: { header: true }
    
    # JS d√©j√† minifi√© (√©vite la minification Drupal)
    js/minified.js: { minified: true }
    
    # Attributs personnalis√©s
    js/custom.js: { 
      attributes: { 
        id: "custom-script",
        "data-version": "1.0"
      } 
    }
    
    # JS non agr√©g√©
    js/no-aggregate.js: { preprocess: false }
```

  </TabItem>
</Tabs>

<Aside type="tip" title="Version obligatoire">
Depuis Drupal 10.1.2, la cl√© `version` est obligatoire dans chaque librairie pour √©viter les probl√®mes de cache.
</Aside>

## üü® JavaScript et IIFE

### Qu'est-ce qu'une IIFE ?

Une **IIFE** (Immediately Invoked Function Expression) est un pattern JavaScript qui permet d'ex√©cuter imm√©diatement une fonction anonyme. C'est essentiel dans Drupal pour √©viter la pollution de l'espace global et g√©rer les d√©pendances proprement.

<Tabs>
  <TabItem label="Syntaxe de base">

```javascript
// Fonction anonyme classique
function() {
  console.log('Hello World!');
}

// Devient une IIFE
(function() {
  console.log('Hello World!');
})();
```

  </TabItem>
  <TabItem label="Avec param√®tres">

```javascript
// IIFE avec param√®tres (injection de d√©pendances)
(function($, Drupal, once) {
  'use strict';
  
  // Code prot√©g√© dans la port√©e locale
  Drupal.behaviors.myBehavior = {
    attach: function(context, settings) {
      // Votre code ici
    }
  };
  
})(jQuery, Drupal, once);
```

  </TabItem>
  <TabItem label="Dans Drupal">

```javascript
// js/tailstore.js - Exemple complet
(function($, Drupal, once) {
  'use strict';
  
  // Comportement pour le menu mobile
  Drupal.behaviors.tailstoreMobileMenu = {
    attach: function(context, settings) {
      once('mobile-menu', '.mobile-menu-toggle', context).forEach(function(element) {
        $(element).on('click', function() {
          $('.main-navigation').toggleClass('is-open');
        });
      });
    }
  };
  
  // Comportement pour les sliders
  Drupal.behaviors.tailstoreSliders = {
    attach: function(context, settings) {
      once('product-slider', '.product-slider', context).forEach(function(element) {
        // Initialisation du slider
        new Swiper(element, {
          slidesPerView: 1,
          spaceBetween: 10,
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          },
        });
      });
    }
  };
  
})(jQuery, Drupal, once);
```

  </TabItem>
</Tabs>

### Pourquoi utiliser les IIFE dans Drupal ?

<Aside type="tip" title="Avantages des IIFE">
- **Port√©e isol√©e** : Les variables sont locales, pas globales
- **√âvite les conflits** : Pas de pollution de `window`
- **Injection de d√©pendances** : Contr√¥le explicite des d√©pendances
- **Mode strict** : Permet d'activer `'use strict'` explicitement
- **Performance** : Code minifi√© plus efficacement
</Aside>

### Structure recommand√©e

```javascript
(function($, Drupal, once) {
  'use strict';
  
  // 1. Variables priv√©es (non accessibles de l'ext√©rieur)
  var privateVariable = 'secret';
  
  // 2. Fonctions priv√©es
  function privateFunction() {
    return 'private';
  }
  
  // 3. Comportements Drupal (accessibles via Drupal.behaviors)
  Drupal.behaviors.myModuleBehavior = {
    attach: function(context, settings) {
      // Code d'initialisation
      once('my-behavior', '.my-selector', context).forEach(function(element) {
        // Logique par √©l√©ment
      });
    },
    
    detach: function(context, settings, trigger) {
      // Code de nettoyage si n√©cessaire
    }
  };
  
  // 4. Fonctions publiques (si n√©cessaire)
  Drupal.myModule = Drupal.myModule || {};
  Drupal.myModule.publicFunction = function() {
    return privateFunction();
  };
  
})(jQuery, Drupal, once);
```

<Aside type="caution" title="D√©pendances Drupal">
Toujours inclure `jQuery`, `Drupal`, et `once` comme param√®tres. Ces objets sont pass√©s automatiquement par Drupal.
</Aside>

## üêò Fichier .theme

Le fichier **tailstore.theme** contient les fonctions PHP qui utilisent le **syst√®me de hooks** de Drupal.

### Qu'est-ce qu'un hook Drupal ?

Un **hook** est un point d'extension dans Drupal qui permet aux modules et th√®mes de modifier ou d'√©tendre le comportement du syst√®me. Les hooks sont des fonctions PHP nomm√©es selon une convention sp√©cifique : `nom_du_module_ou_theme_nom_du_hook()`.

<Tabs>
  <TabItem label="Types de hooks utilis√©s">

```php
// Hook de pr√©processing : Modifie les variables avant le rendu
hook_preprocess_HOOK(&$variables)

// Hook d'alt√©ration de formulaire : Modifie les formulaires
hook_form_alter(&$form, $form_state, $form_id)

// Hook de suggestions de template : Ajoute des templates alternatifs
hook_theme_suggestions_HOOK_alter(&$suggestions, $variables)
```

  </TabItem>
  <TabItem label="Convention de nommage">

```php
// Pour un th√®me nomm√© "tailstore" :
// hook_preprocess_page ‚Üí tailstore_preprocess_page
// hook_form_alter ‚Üí tailstore_form_alter
// hook_theme_suggestions_node_alter ‚Üí tailstore_theme_suggestions_node_alter

function tailstore_preprocess_page(&$variables) {
  // Votre code ici
}
```

  </TabItem>
</Tabs>

<Aside type="tip" title="R√¥le des hooks dans les th√®mes">
- **Pr√©processing** : Pr√©parer/modifier les donn√©es avant l'affichage
- **Alt√©ration** : Modifier les formulaires et leur comportement  
- **Suggestions** : Proposer des templates alternatifs selon le contexte
</Aside>

<Aside type="note" title="Ressources officielles">
Pour une liste compl√®te des hooks disponibles dans Drupal, consultez :
- [Documentation des hooks Drupal](https://www.drupal.org/node/3551652)
- [API Drupal - Hooks (v11.x)](https://api.drupal.org/api/drupal/core!core.api.php/group/hooks/11.x)

**√âvolution des hooks dans Drupal 11 :**
- [Nouveaux hooks avec attributs vs hooks proc√©duraux](https://dev.to/xwero/new-drupal-hook-attribute-34n0)
</Aside>

Le fichier **tailstore.theme** contient les fonctions PHP :

```php
<?php

/**
 * @file
 * Functions to support theming in the TailStore theme.
 */

use Drupal\Core\Form\FormStateInterface;

/**
 * Implements hook_preprocess_HOOK() for html.html.twig.
 *
 * Ce hook permet de modifier les variables avant le rendu du template html.html.twig.
 * Ici, on ajoute des classes CSS au body pour le styling et la logique conditionnelle.
 */
function tailstore_preprocess_html(&$variables) {
  // Ajouter une classe globale au th√®me
  $variables['attributes']['class'][] = 'tailstore-theme';
  
  // Ajouter une classe sp√©cifique pour les pages produit
  // Utile pour appliquer des styles particuliers aux pages e-commerce
  $node = \Drupal::routeMatch()->getParameter('node');
  if ($node && $node->bundle() === 'product') {
    $variables['attributes']['class'][] = 'page-product';
  }
}

/**
 * Implements hook_preprocess_HOOK() for page.html.twig.
 *
 * Ce hook permet de modifier les variables avant le rendu du template page.html.twig.
 * Ici, on charge des librairies JavaScript selon le contexte de la page.
 */
function tailstore_preprocess_page(&$variables) {
  // Charger la librairie slider uniquement sur la page d'accueil
  // √âvite de charger du JS inutile sur les autres pages
  if (\Drupal::service('path.matcher')->isFrontPage()) {
    $variables['#attached']['library'][] = 'tailstore/slider';
    $variables['#attached']['library'][] = 'tailstore/swiper';
  }
}

/**
 * Implements hook_preprocess_HOOK() for node.html.twig.
 *
 * Ce hook permet de modifier les variables avant le rendu des nodes.
 * Ici, on pr√©pare des donn√©es sp√©cifiques pour les produits e-commerce.
 */
function tailstore_preprocess_node(&$variables) {
  /** @var \Drupal\node\NodeInterface $node */
  $node = $variables['node'];
  
  // Variables personnalis√©es pour les produits
  if ($node->bundle() === 'product') {
    // Formater le prix avec s√©parateur fran√ßais
    if ($node->hasField('field_price') && !$node->get('field_price')->isEmpty()) {
      $variables['formatted_price'] = number_format(
        $node->get('field_price')->value,
        2,
        ',',
        ' '
      ) . ' ‚Ç¨';
    }
    
    // V√©rifier la disponibilit√© en stock
    if ($node->hasField('field_stock')) {
      $variables['in_stock'] = $node->get('field_stock')->value > 0;
    }
    
    // Gestion des prix barr√©s pour les promotions
    if ($node->hasField('field_old_price') && !$node->get('field_old_price')->isEmpty()) {
      $variables['old_price'] = number_format(
        $node->get('field_old_price')->value,
        2,
        ',',
        ' '
      ) . ' ‚Ç¨';
      $variables['is_on_sale'] = TRUE;
    }
  }
}

/**
 * Implements hook_preprocess_HOOK() for field.html.twig.
 *
 * Ce hook permet de modifier les variables avant le rendu des champs.
 * Ici, on ajoute des classes CSS sp√©cifiques selon le type de champ.
 */
function tailstore_preprocess_field(&$variables) {
  $field_name = $variables['field_name'];
  
  // Ajouter une classe sp√©cifique pour le prix
  if ($field_name === 'field_price') {
    $variables['attributes']['class'][] = 'product-price';
  }
}

/**
 * Implements hook_form_alter().
 *
 * Ce hook permet de modifier tous les formulaires du syst√®me.
 * Ici, on personnalise l'apparence et le comportement de certains formulaires.
 */
function tailstore_form_alter(&$form, FormStateInterface $form_state, $form_id) {
  // Personnaliser le formulaire de recherche
  if ($form_id === 'search_block_form') {
    $form['keys']['#attributes']['placeholder'] = t('Rechercher...');
    $form['keys']['#attributes']['class'][] = 'search-input';
  }
  
  // Personnaliser les filtres expos√©s des vues
  if (strpos($form_id, 'views_exposed_form') === 0) {
    $form['#attributes']['class'][] = 'filters-form';
  }
}

/**
 * Implements hook_theme_suggestions_HOOK_alter() for node.
 *
 * Ce hook permet de sugg√©rer des templates alternatifs selon le contexte.
 * Ici, on propose des templates sp√©cifiques pour les produits en promotion.
 */
function tailstore_theme_suggestions_node_alter(array &$suggestions, array $variables) {
  /** @var \Drupal\node\NodeInterface $node */
  $node = $variables['elements']['#node'];
  $view_mode = $variables['elements']['#view_mode'];
  
  // Ajouter une suggestion bas√©e sur un champ personnalis√©
  if ($node->bundle() === 'product' && $node->hasField('field_featured')) {
    if ($node->get('field_featured')->value) {
      $suggestions[] = 'node__product__featured';
      $suggestions[] = 'node__product__' . $view_mode . '__featured';
    }
  }
}
```

## üìê Fichier .breakpoints.yml

Le fichier **tailstore.breakpoints.yml** d√©finit les points de rupture responsive :

```yaml
# tailstore.breakpoints.yml

tailstore.mobile:
  label: Mobile
  mediaQuery: ''
  weight: 0
  multipliers:
    - 1x
    - 2x

tailstore.narrow:
  label: Narrow
  mediaQuery: 'all and (min-width: 560px)'
  weight: 1
  multipliers:
    - 1x
    - 2x

tailstore.medium:
  label: Medium
  mediaQuery: 'all and (min-width: 768px)'
  weight: 2
  multipliers:
    - 1x
    - 2x

tailstore.wide:
  label: Wide
  mediaQuery: 'all and (min-width: 1024px)'
  weight: 3
  multipliers:
    - 1x
    - 2x

tailstore.extra_wide:
  label: Extra Wide
  mediaQuery: 'all and (min-width: 1280px)'
  weight: 4
  multipliers:
    - 1x
    - 2x
```

<Aside type="tip" title="Module requis">
Pour utiliser les breakpoints d√©finis dans `tailstore.breakpoints.yml`, vous devez activer le module **Breakpoint** du core Drupal :

```bash
# Via Drush
drush pm:enable breakpoint -y

# Ou via l'interface : Administration > Extend > Core > Breakpoint
```
</Aside>

## ‚úÖ Activer le th√®me

### Via l'interface

1. **Appearance** (`/admin/appearance`)
2. Trouvez "TailStore" dans la liste
3. Cliquez sur **Install and set as default**

### Via Drush

```bash
# Activer le th√®me
drush theme:enable tailstore

# D√©finir comme th√®me par d√©faut
drush config:set system.theme default tailstore -y

# Vider le cache
drush cr
```

## üé® CSS de base

### css/base/reset.css

```css
/* Reset moderne */
*,
*::before,
*::after {
  box-sizing: border-box;
}

* {
  margin: 0;
  padding: 0;
}

html {
  font-size: 16px;
  scroll-behavior: smooth;
}

body {
  line-height: 1.5;
  -webkit-font-smoothing: antialiased;
}

img,
picture,
video,
canvas,
svg {
  display: block;
  max-width: 100%;
}

input,
button,
textarea,
select {
  font: inherit;
}

p,
h1,
h2,
h3,
h4,
h5,
h6 {
  overflow-wrap: break-word;
}
```

### css/base/typography.css

```css
/* Variables de typographie */
:root {
  --font-sans: 'Inter', system-ui, -apple-system, sans-serif;
  --font-mono: 'Fira Code', monospace;
  
  --text-xs: 0.75rem;
  --text-sm: 0.875rem;
  --text-base: 1rem;
  --text-lg: 1.125rem;
  --text-xl: 1.25rem;
  --text-2xl: 1.5rem;
  --text-3xl: 2rem;
  --text-4xl: 2.5rem;
}

body {
  font-family: var(--font-sans);
  font-size: var(--text-base);
  color: var(--color-dark, #1a1a2e);
}

h1, h2, h3, h4, h5, h6 {
  font-weight: 600;
  line-height: 1.2;
}

h1 { font-size: var(--text-4xl); }
h2 { font-size: var(--text-3xl); }
h3 { font-size: var(--text-2xl); }
h4 { font-size: var(--text-xl); }

a {
  color: var(--color-primary, #0073e6);
  text-decoration: none;
}

a:hover {
  text-decoration: underline;
}
```

## üñºÔ∏è Logo

Placez votre logo dans `images/logo.svg` ou configurez-le via :

1. **Appearance** ‚Üí **Settings** ‚Üí **TailStore**
2. Section **Logo image**
3. Uploadez ou sp√©cifiez le chemin

## üíæ V√©rifier l'installation

```bash
# V√©rifier que le th√®me est actif
drush config:get system.theme default

# Devrait retourner : 'tailstore'

# Vider le cache
drush cr

# Visitez le site pour voir le th√®me
```

## ‚úÖ Checklist

- [ ] Dossier `themes/custom/tailstore` cr√©√©
- [ ] `tailstore.info.yml` configur√©
- [ ] `tailstore.libraries.yml` avec librairie global
- [ ] `tailstore.theme` avec hooks de base
- [ ] `tailstore.breakpoints.yml` pour le responsive
- [ ] CSS de base (reset, typography)
- [ ] Th√®me activ√© et d√©fini par d√©faut
- [ ] Site accessible avec le nouveau th√®me

## üîú Prochaine √©tape

Le th√®me est cr√©√© ! Passons aux [Templates Twig](/etape-6-theming/twig/).
