---
title: Exercices Ã‰tape 8
description: Mise en pratique du dÃ©veloppement de modules Drupal custom
sidebar:
  order: 7
---

import { Tabs, TabItem, Aside, Card, CardGrid, Steps } from '@astrojs/starlight/components';

> ğŸ§­ Rappel : le thÃ¨me Tailstore est dÃ©jÃ  crÃ©Ã© Ã  l'Ã©tape 6. Les snippets ci-dessous donnent les solutions complÃ¨tes pour reproduire les Ã©crans **Home**, **Listing produits**, **Fiche produit** et **Checkout** en Drupal 11 avec les champs dÃ©jÃ  prÃ©sents.

## ğŸ¯ Objectifs

Ã€ la fin de ces exercices, vous aurez :
- CrÃ©Ã© le module `tailstore_cart` complet
- ImplÃ©mentÃ© le service de panier
- IntÃ©grÃ© htmx pour les interactions
- ConfigurÃ© Stripe Checkout


---

## Exercice 1 : CrÃ©er le module

<Card title="DurÃ©e estimÃ©e : 20 minutes" icon="clock">
  CrÃ©er la structure de base du module tailstore_cart.
</Card>

### Objectif

Initialiser le module avec tous les fichiers de base.

### Instructions

<Steps>

1. **CrÃ©er la structure de dossiers**

   ```bash
   mkdir -p web/modules/custom/tailstore_cart/{src/{Controller,Service,Form,Plugin/Block},templates,config/{install,schema},js,css}
   ```

2. **CrÃ©er tailstore_cart.info.yml**

   ```yaml
   name: TailStore Cart
   type: module
   description: 'Shopping cart and Stripe checkout for TailStore'
   core_version_requirement: ^10 || ^11
   package: TailStore
   version: 1.0.0
   dependencies:
     - drupal:node
     - drupal:user
   configure: tailstore_cart.settings
   ```

3. **CrÃ©er tailstore_cart.module**

   ```php
   <?php

   declare(strict_types=1);

   /**
    * @file
    * Primary module hooks for TailStore Cart.
    */

   /**
    * Implements hook_theme().
    */
   function tailstore_cart_theme(): array {
     return [
       'cart_page' => [
         'variables' => ['items' => [], 'total' => 0],
       ],
       'mini_cart' => [
         'variables' => ['count' => 0, 'total' => 0, 'items' => []],
       ],
       'checkout_success' => [
         'variables' => ['session' => NULL, 'order_email' => '', 'amount' => 0, 'currency' => ''],
       ],
       'checkout_cancel' => [
         'variables' => ['cart_url' => ''],
       ],
     ];
   }

   /**
    * Implements hook_page_attachments().
    */
   function tailstore_cart_page_attachments(array &$attachments): void {
     $attachments['#attached']['library'][] = 'tailstore_cart/htmx';
   }
   ```

4. **CrÃ©er tailstore_cart.libraries.yml**

   ```yaml
   htmx:
     version: 2.0
     js:
       https://unpkg.com/htmx.org@2.0.4/dist/htmx.min.js:
         type: external
         minified: true
         attributes:
           defer: true

   cart:
     version: 1.0
     css:
       component:
         css/cart.css: {}
     dependencies:
       - tailstore_cart/htmx
   ```

5. **CrÃ©er tailstore_cart.permissions.yml**

   ```yaml
   access cart:
     title: 'Access shopping cart'
     description: 'View and manage shopping cart'

   access checkout:
     title: 'Access checkout'
     description: 'Proceed to payment'

   administer tailstore cart:
     title: 'Administer TailStore Cart'
     restrict access: true
   ```

6. **Activer le module**

   ```bash
   ddev drush en tailstore_cart -y
   ```

</Steps>

### Validation âœ“

- [ ] Module activÃ© sans erreur
- [ ] Visible dans la liste des modules
- [ ] Permissions apparaissent

---

## Exercice 2 : Service CartService

<Card title="DurÃ©e estimÃ©e : 40 minutes" icon="clock">
  ImplÃ©menter le service de gestion du panier.
</Card>

### Objectif

CrÃ©er un service complet pour gÃ©rer le panier en session.

### Instructions

<Steps>

1. **CrÃ©er l'interface**

   `src/Service/CartServiceInterface.php` avec les mÃ©thodes :
   - `add(int $productId, int $quantity): void`
   - `remove(int $productId): void`
   - `updateQuantity(int $productId, int $quantity): void`
   - `getItems(): array`
   - `getItem(int $productId): ?array`
   - `getCount(): int`
   - `getTotal(): float`
   - `clear(): void`

2. **CrÃ©er l'implÃ©mentation**

   `src/Service/CartService.php` :
   - Utiliser la session pour stocker les donnÃ©es
   - Charger les produits via EntityTypeManager
   - Calculer les totaux

3. **DÃ©clarer le service**

   `tailstore_cart.services.yml` :
   ```yaml
   services:
     tailstore_cart.cart:
       class: Drupal\tailstore_cart\Service\CartService
       arguments:
         - '@request_stack'
         - '@entity_type.manager'
   ```

4. **Tester**

   ```bash
   ddev drush php:eval "
     \$cart = \Drupal::service('tailstore_cart.cart');
     \$cart->add(1, 2);
     print_r(\$cart->getItems());
   "
   ```

</Steps>

### Validation âœ“

- [ ] Interface crÃ©Ã©e avec toutes les mÃ©thodes
- [ ] CartService implÃ©mentÃ©
- [ ] Service dÃ©clarÃ© dans services.yml
- [ ] Test via drush fonctionnel

---

## Exercice 3 : Routes et Controllers

<Card title="DurÃ©e estimÃ©e : 45 minutes" icon="clock">
  CrÃ©er les routes et controllers pour le panier.
</Card>

### Objectif

ImplÃ©menter toutes les routes pour les opÃ©rations du panier.

### Instructions

<Steps>

1. **CrÃ©er tailstore_cart.routing.yml**

   Routes Ã  crÃ©er :
   - `GET /cart` â†’ page panier
   - `POST /cart/add/{product_id}` â†’ ajouter
   - `PATCH /cart/update/{product_id}` â†’ modifier quantitÃ©
   - `DELETE /cart/remove/{product_id}` â†’ supprimer
   - `GET /cart/mini` â†’ mini-cart (htmx)

2. **CrÃ©er CartController**

   `src/Controller/CartController.php` :
   - Injection de CartService
   - MÃ©thodes pour chaque route
   - DÃ©tection des requÃªtes htmx
   - RÃ©ponses HTML fragments ou JSON

3. **CrÃ©er les templates**

   - `templates/cart-page.html.twig`
   - `templates/mini-cart.html.twig`

4. **Tester les routes**

   ```bash
   ddev drush router:list --module=tailstore_cart
   ```

</Steps>

### Validation âœ“

- [ ] Toutes les routes dÃ©finies
- [ ] CartController fonctionnel
- [ ] Page /cart accessible
- [ ] Templates crÃ©Ã©s

---

## Exercice 4 : IntÃ©gration htmx

<Card title="DurÃ©e estimÃ©e : 35 minutes" icon="clock">
  Ajouter les interactions htmx dans les templates.
</Card>

### Objectif

Rendre le panier interactif sans recharger la page.

### Instructions

<Steps>

1. **Modifier le template produit**

   Ajouter le bouton htmx :
   ```twig
   <button 
     hx-post="/cart/add/{{ node.id }}"
     hx-target="#mini-cart"
     hx-swap="innerHTML"
   >
     Ajouter au panier
   </button>
   ```

2. **CrÃ©er le mini-cart dans le header**

   - Bloc ou template personnalisÃ©
   - Affiche le compteur et le total
   - Dropdown avec liste des articles

3. **Mise Ã  jour des quantitÃ©s**

   Dans la page panier :
   - Boutons +/- avec htmx
   - Input avec hx-trigger="change"

4. **Suppression avec confirmation**

   ```twig
   <button
     hx-delete="/cart/remove/{{ item.product.id }}"
     hx-target="closest tr"
     hx-swap="outerHTML"
     hx-confirm="Supprimer cet article ?"
   >
     Supprimer
   </button>
   ```

5. **Tester les interactions**

   - Ajouter un produit
   - Modifier la quantitÃ©
   - Supprimer un article
   - VÃ©rifier le mini-cart

</Steps>

### Validation âœ“

- [ ] Bouton ajout panier fonctionnel
- [ ] Mini-cart mis Ã  jour dynamiquement
- [ ] QuantitÃ©s modifiables
- [ ] Suppression avec animation
- [ ] Pas de rechargement de page

---

## Exercice 5 : Formulaire de configuration

<Card title="DurÃ©e estimÃ©e : 25 minutes" icon="clock">
  CrÃ©er le formulaire d'administration.
</Card>

### Objectif

Permettre la configuration des clÃ©s Stripe via l'interface.

### Instructions

<Steps>

1. **CrÃ©er SettingsForm**

   `src/Form/SettingsForm.php` :
   - Ã‰tendre `ConfigFormBase`
   - Champs pour les clÃ©s Stripe
   - SÃ©lection de la devise
   - Validation des clÃ©s

2. **CrÃ©er la configuration par dÃ©faut**

   `config/install/tailstore_cart.settings.yml`

3. **CrÃ©er le schÃ©ma**

   `config/schema/tailstore_cart.schema.yml`

4. **Ajouter le lien de menu admin**

   `tailstore_cart.links.menu.yml` :
   ```yaml
   tailstore_cart.settings:
     title: 'TailStore Cart'
     route_name: tailstore_cart.settings
     parent: system.admin_config_system
     description: 'Configure TailStore Cart settings'
   ```

5. **Tester**

   - AccÃ©der Ã  `/admin/config/system/tailstore-cart`
   - Saisir des clÃ©s test
   - VÃ©rifier la sauvegarde

</Steps>

### Validation âœ“

- [ ] Formulaire accessible dans l'admin
- [ ] ClÃ©s Stripe configurables
- [ ] Validation fonctionnelle
- [ ] Configuration sauvegardÃ©e

---

## Exercice 6 : IntÃ©gration Stripe

<Card title="DurÃ©e estimÃ©e : 50 minutes" icon="clock">
  ImplÃ©menter le paiement Stripe Checkout.
</Card>

### Objectif

Permettre le paiement via Stripe Checkout en mode redirect.

### Instructions

<Steps>

1. **Installer la SDK Stripe**

   ```bash
   ddev composer require stripe/stripe-php
   ```

2. **CrÃ©er StripeService**

   `src/Service/StripeService.php` :
   - Initialisation avec la clÃ© secrÃ¨te
   - `createCheckoutSession()`
   - `getSession()`
   - `handleWebhook()`

3. **CrÃ©er CheckoutController**

   `src/Controller/CheckoutController.php` :
   - `index()` : page rÃ©capitulative
   - `create()` : crÃ©ation session Stripe
   - `success()` : page de confirmation
   - `cancel()` : page d'annulation

4. **Ajouter les routes checkout**

   ```yaml
   tailstore_cart.checkout:
     path: '/checkout'
     defaults:
       _controller: '\Drupal\tailstore_cart\Controller\CheckoutController::index'
     requirements:
       _permission: 'access checkout'
   
   tailstore_cart.checkout_create:
     path: '/checkout/create'
     methods: [POST]
     ...
   ```

5. **CrÃ©er les templates**

   - `checkout-success.html.twig`
   - `checkout-cancel.html.twig`

6. **Tester avec les cartes test**

   - `4242 4242 4242 4242` pour succÃ¨s
   - VÃ©rifier la redirection
   - VÃ©rifier le vidage du panier

</Steps>

### Validation âœ“

- [ ] SDK Stripe installÃ©e
- [ ] Session Stripe crÃ©Ã©e
- [ ] Redirection vers Stripe OK
- [ ] Page succÃ¨s affichÃ©e
- [ ] Panier vidÃ© aprÃ¨s paiement

---

## Exercice 7 : Webhook Stripe

<Card title="DurÃ©e estimÃ©e : 30 minutes" icon="clock">
  ImplÃ©menter le webhook pour confirmer les paiements.
</Card>

### Objectif

Recevoir et traiter les notifications Stripe.

### Instructions

<Steps>

1. **CrÃ©er WebhookController**

   `src/Controller/WebhookController.php` :
   - Validation de la signature
   - Dispatch selon le type d'event
   - Logging des Ã©vÃ©nements

2. **Ajouter la route webhook**

   ```yaml
   tailstore_cart.webhook_stripe:
     path: '/webhook/stripe'
     defaults:
       _controller: '\Drupal\tailstore_cart\Controller\WebhookController::stripe'
     requirements:
       _access: 'TRUE'
     methods: [POST]
   ```

3. **Configurer Stripe CLI**

   ```bash
   stripe listen --forward-to https://tailstore.ddev.site/webhook/stripe
   ```

4. **Tester les Ã©vÃ©nements**

   ```bash
   stripe trigger checkout.session.completed
   ```

5. **VÃ©rifier les logs**

   ```bash
   ddev drush watchdog:show --type=tailstore_cart
   ```

</Steps>

### Validation âœ“

- [ ] Webhook route crÃ©Ã©e
- [ ] Signature validÃ©e
- [ ] Events loggÃ©s
- [ ] Tests CLI fonctionnels

---

## Exercice 8 : Bloc Mini-Cart

<Card title="DurÃ©e estimÃ©e : 25 minutes" icon="clock">
  CrÃ©er un bloc Drupal pour le mini-cart.
</Card>

### Objectif

Afficher le mini-cart comme bloc configurable.

### Instructions

<Steps>

1. **CrÃ©er le Plugin Block**

   `src/Plugin/Block/MiniCartBlock.php` :
   ```php
   /**
    * @Block(
    *   id = "tailstore_mini_cart",
    *   admin_label = @Translation("TailStore Mini Cart"),
    *   category = @Translation("TailStore")
    * )
    */
   class MiniCartBlock extends BlockBase implements ContainerFactoryPluginInterface {
     // ...
   }
   ```

2. **Injecter CartService**

   Via `ContainerFactoryPluginInterface`

3. **ImplÃ©menter build()**

   Retourner le render array avec le template mini-cart

4. **Placer le bloc**

   - Structure â†’ Mise en page des blocs
   - RÃ©gion Header

5. **Tester**

   - Ajouter des produits
   - VÃ©rifier l'affichage dans le header

</Steps>

### Validation âœ“

- [ ] Plugin Block crÃ©Ã©
- [ ] Bloc visible dans l'admin
- [ ] Bloc placÃ© dans le header
- [ ] Mise Ã  jour dynamique

---

## ğŸ† RÃ©capitulatif Ã‰tape 8

<CardGrid>
  <Card title="Module crÃ©Ã©" icon="puzzle">
    Structure complÃ¨te PSR-4
  </Card>
  <Card title="Services" icon="setting">
    Cart + Stripe services
  </Card>
  <Card title="htmx intÃ©grÃ©" icon="rocket">
    Interactions dynamiques
  </Card>
  <Card title="Paiement" icon="seti:salesforce">
    Stripe Checkout fonctionnel
  </Card>
</CardGrid>

## ğŸ§© Solutions complÃ¨tes Tailstore (Twig + PHP)

Ces extraits sont Â« prÃªts Ã  coller Â» pour retrouver exactement le rendu des pages HTML Tailstore (home, listing, fiche produit, checkout) :

- [web/themes/custom/tailstore/templates/page--front.html.twig](web/themes/custom/tailstore/templates/page--front.html.twig) â€“ Home (slider, banniÃ¨res, popular/latest, brands, blog, newsletter)
- [web/themes/custom/tailstore/templates/views-view--products--page.html.twig](web/themes/custom/tailstore/templates/views-view--products--page.html.twig) â€“ Listing produits
- [web/themes/custom/tailstore/templates/node--product.html.twig](web/themes/custom/tailstore/templates/node--product.html.twig) â€“ Fiche produit
- [web/themes/custom/tailstore/templates/page--checkout.html.twig](web/themes/custom/tailstore/templates/page--checkout.html.twig) â€“ Checkout
- [web/modules/custom/tailstore_cart/src/Plugin/Block/MiniCartBlock.php](web/modules/custom/tailstore_cart/src/Plugin/Block/MiniCartBlock.php) â€“ Bloc mini-cart (header)
- [web/modules/custom/tailstore_cart/src/Controller/CartController.php](web/modules/custom/tailstore_cart/src/Controller/CartController.php) â€“ Panier (htmx + pages)
- [web/modules/custom/tailstore_cart/src/Controller/CheckoutController.php](web/modules/custom/tailstore_cart/src/Controller/CheckoutController.php) â€“ Checkout + Stripe

### Home â€“ page--front.html.twig

```twig
{# page--front.html.twig #}
{% extends "page.html.twig" %}

{% block content %}
  {# Slider #}
  <section id="product-slider">
    <div class="main-slider swiper-container">
      <div class="swiper-wrapper">
        {% for slide in slides %}
          <div class="swiper-slide">
            <img src="{{ slide.image }}" alt="{{ slide.title }}">
            <div class="swiper-slide-content">
              <h2 class="text-3xl md:text-7xl font-bold text-white mb-2 md:mb-4">{{ slide.title }}</h2>
              <p class="mb-4 text-white md:text-2xl">{{ slide.subtitle }}</p>
              <a href="{{ slide.cta_url }}" class="bg-primary hover:bg-transparent text-white hover:text-white border border-transparent hover:border-white font-semibold px-4 py-2 rounded-full inline-block">{{ slide.cta_label }}</a>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
    <div class="swiper-button-prev"></div>
    <div class="swiper-button-next"></div>
  </section>

  {# BanniÃ¨res catÃ©gories #}
  <section id="product-banners">
    <div class="container mx-auto py-10">
      <div class="flex flex-wrap -mx-4">
        {% for category in hero_categories %}
          <div class="w-full sm:w-1/3 px-4 mb-8">
            <div class="category-banner relative overflow-hidden rounded-lg shadow-lg group">
              <img src="{{ category.image }}" alt="{{ category.title }}" class="w-full h-auto">
              <div class="absolute inset-0 bg-gray-light bg-opacity-50"></div>
              <div class="absolute inset-0 flex flex-col items-center justify-center text-center text-white p-4">
                <h2 class="text-2xl md:text-3xl font-bold mb-4">{{ category.title }}</h2>
                <a href="{{ category.url }}" class="bg-primary hover:bg-transparent border border-transparent hover:border-white text-white hover:text-white font-semibold px-4 py-2 rounded-full inline-block">Shop now</a>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </section>

  {# Popular products #}
  <section id="popular-products">
    <div class="container mx-auto px-4">
      <h2 class="text-2xl font-bold mb-8">Popular products</h2>
      <div class="flex flex-wrap -mx-4">
        {% for product in popular_products %}
          <div class="w-full sm:w-1/2 lg:w-1/4 px-4 mb-8">
            <div class="bg-white p-3 rounded-lg shadow-lg">
              {{ product.field_image }}
              <a href="{{ path('entity.node.canonical', {'node': product.id}) }}" class="text-lg font-semibold mb-2">{{ product.label }}</a>
              <p class="my-2">{{ product.field_category }}</p>
              <div class="flex items-center mb-4">
                <span class="text-lg font-bold text-primary">{{ product.field_price }}</span>
                {% if product.field_old_price %}<span class="text-sm line-through ml-2">{{ product.field_old_price }}</span>{% endif %}
              </div>
              <button hx-post="/cart/add/{{ product.id }}" hx-target="#mini-cart" hx-swap="innerHTML" class="bg-primary border border-transparent hover:bg-transparent hover:border-primary text-white hover:text-primary font-semibold py-2 px-4 rounded-full w-full">Add to Cart</button>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </section>

  {# Latest products #}
  <section id="latest-products" class="py-10">
    <div class="container mx-auto px-4">
      <h2 class="text-2xl font-bold mb-8">Latest products</h2>
      <div class="flex flex-wrap -mx-4">
        {% for product in latest_products %}
          <div class="w-full sm:w-1/2 lg:w-1/4 px-4 mb-8">
            <div class="bg-white p-3 rounded-lg shadow-lg">
              {{ product.field_image }}
              <a href="{{ path('entity.node.canonical', {'node': product.id}) }}" class="text-lg font-semibold mb-2">{{ product.label }}</a>
              <p class=" my-2">{{ product.field_category }}</p>
              <div class="flex items-center mb-4">
                <span class="text-lg font-bold text-primary">{{ product.field_price }}</span>
                {% if product.field_old_price %}<span class="text-sm line-through ml-2">{{ product.field_old_price }}</span>{% endif %}
              </div>
              <button hx-post="/cart/add/{{ product.id }}" hx-target="#mini-cart" hx-swap="innerHTML" class="bg-primary border border-transparent hover:bg-transparent hover:border-primary text-white hover:text-primary font-semibold py-2 px-4 rounded-full w-full">Add to Cart</button>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </section>

  {# Brands carousel #}
  <section id="brands" class="bg-white py-16 px-4">
    <div class="container mx-auto max-w-screen-xl px-4">
      <div class="text-center mb-12 lg:mb-20">
        <h2 class="text-5xl font-bold mb-4">Discover <span class="text-primary">Our Brands</span></h2>
        <p class="my-7">Explore the top brands we feature in our store</p>
      </div>
      <div class="swiper brands-swiper-slider">
        <div class="swiper-wrapper">
          {% for brand in brands %}
            <div class="swiper-slide flex-none bg-gray-200 flex items-center justify-center rounded-md">
              <img src="{{ brand.logo }}" alt="{{ brand.name }}" class="max-h-full max-w-full">
            </div>
          {% endfor %}
        </div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-button-next"></div>
      </div>
    </div>
  </section>

  {# Banner CTA #}
  <section id="banner" class="relative my-16">
    <div class="container mx-auto px-4 py-20 rounded-lg relative bg-cover bg-center" style="background-image: url('{{ banner.image }}');">
      <div class="absolute inset-0 bg-black opacity-40 rounded-lg"></div>
      <div class="relative flex flex-col items-center justify-center h-full text-center text-white py-20">
        <h2 class="text-4xl font-bold mb-4">{{ banner.title }}</h2>
        <div class="flex space-x-4">
          <a href="{{ banner.primary_url }}" class="bg-primary hover:bg-transparent text-white hover:text-primary border border-transparent hover:border-primary font-semibold px-4 py-2 rounded-full inline-block">{{ banner.primary_label }}</a>
          <a href="{{ banner.secondary_url }}" class="bg-primary hover:bg-transparent text-white hover:text-primary border border-transparent hover:border-primary font-semibold px-4 py-2 rounded-full inline-block">{{ banner.secondary_label }}</a>
        </div>
      </div>
    </div>
  </section>

  {# Blog #}
  <section class="py-16">
    <div class="text-center mb-12 lg:mb-20">
      <h2 class="text-5xl font-bold mb-4">Discover <span class="text-primary">Our</span> Blog</h2>
      <p class="my-7">Stay updated with the latest trends, tips, and stories</p>
    </div>
    <div class="relative items-center w-full px-5 py-12 mx-auto md:px-12 lg:px-24 max-w-7xl">
      <div class="grid w-full grid-cols-1 gap-6 mx-auto lg:grid-cols-3">
        {% for post in blog_posts %}
          <div class="flex flex-col p-6 bg-white rounded-xl shadow-lg">
            {{ post.image }}
            <h2 class="mb-2 text-xs font-semibold tracking-widest text-primary uppercase">{{ post.category }}</h2>
            <h1 class="mb-4 text-2xl font-semibold leading-none tracking-tighter text-gray-dark lg:text-3xl">{{ post.title }}</h1>
            <p class="flex-grow text-base font-medium leading-relaxed text-gray-txt">{{ post.excerpt }}</p>
            <div class="mt-8">
              <a href="{{ post.url }}" class="bg-primary border border-transparent hover:bg-transparent hover:border-primary text-white hover:text-primary font-semibold py-2 px-4 rounded-full w-full">Read more</a>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>
  </section>

  {# Newsletter #}
  <section id="subscribe" class="py-6 lg:py-24 bg-white border-t border-gray-line">
    <div class="container mx-auto">
      <div class="flex flex-col items-center rounded-lg p-4 sm:p-0">
        <div class="mb-8">
          <h2 class="text-center text-xl font-bold sm:text-2xl lg:text-left lg:text-3xl">Join our newsletter and <span class="text-primary">get $50 discount</span> for your first order</h2>
        </div>
        <div class="flex flex-col items-center w-96">
          <form class="flex w-full gap-2" method="post" action="/newsletter">
            <input name="email" placeholder="Enter your email address" class="w-full flex-1 rounded-full px-3 py-2 border border-gray-300 text-gray-700 placeholder-gray-500 focus:outline-none focus:border-primary focus:ring-2 focus:ring-primary" />
            <button class="bg-primary border border-primary hover:bg-transparent hover:border-primary text-white hover:text-primary font-semibold py-2 px-4 rounded-full">Subscribe</button>
          </form>
        </div>
      </div>
    </div>
  </section>
{% endblock %}
```

### Listing produits â€“ views-view--products--page.html.twig

```twig
<section id="shop">
  <div class="container mx-auto">
    <div class="flex flex-col md:flex-row">
      <div class="w-full md:w-1/4 p-4">
        {{ exposed_filters }}
      </div>
      <div class="w-full md:w-3/4 p-4">
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
          {% for row in rows %}{{ row.content }}{% endfor %}
        </div>
        {{ pager }}
      </div>
    </div>
  </div>
</section>
```

### Fiche produit â€“ node--product.html.twig (extrait actions)

```twig
<div class="product__actions">
  <div class="flex items-center mb-8">
    <button class="bg-primary hover:bg-transparent border border-transparent hover:border-primary text-white hover:text-primary font-semibold w-10 h-10 rounded-full" data-qty="down">-</button>
    <input type="number" name="quantity" value="1" min="1" class="w-16 py-2 text-center" />
    <button class="bg-primary hover:bg-transparent border border-transparent hover:border-primary text-white hover:text-primary font-semibold w-10 h-10 rounded-full" data-qty="up">+</button>
  </div>
  <button hx-post="/cart/add/{{ node.id }}" hx-vals='{"quantity": this.previousElementSibling.querySelector("input").value}' hx-target="#mini-cart" hx-swap="innerHTML" class="bg-primary border border-transparent hover:bg-transparent hover:border-primary text-white hover:text-primary font-semibold py-2 px-4 rounded-full">Add to Cart</button>
</div>
```

### Checkout â€“ page--checkout.html.twig (rÃ©capitulatif)

```twig
<section id="checkout-page" class="bg-white py-16">
  <div class="container mx-auto px-4">
    <div class="flex flex-col md:flex-row gap-4">
      <div class="md:w-2/3 bg-white rounded-lg shadow-md p-4">
        {{ checkout_form }}
      </div>
      <div class="md:w-1/3 bg-white rounded-lg shadow-md p-4">
        <h2 class="text-xl font-semibold mb-4">Order Summary</h2>
        <div class="flex justify-between mb-4"><p>Subtotal</p><p>{{ summary.subtotal }}</p></div>
        <div class="flex justify-between mb-4"><p>Shipping</p><p>{{ summary.shipping }}</p></div>
        <div class="flex justify-between mb-4"><p class="font-semibold">Total</p><p class="font-semibold">{{ summary.total }}</p></div>
        <button class="bg-primary text-white border border-primary hover:bg-transparent hover:text-primary py-2 px-4 rounded-full w-full" formaction="/checkout/create">Proceed to Payment</button>
      </div>
    </div>
  </div>
</section>
```

### Bloc Mini-cart (solution)

```php
namespace Drupal\tailstore_cart\Plugin\Block;

use Drupal\Core\Block\BlockBase;
use Drupal\Core\Plugin\ContainerFactoryPluginInterface;
use Drupal\tailstore_cart\Service\CartServiceInterface;
use Symfony\Component\DependencyInjection\ContainerInterface;

/**
 * @Block(
 *   id = "tailstore_mini_cart",
 *   admin_label = @Translation("TailStore Mini Cart"),
 *   category = @Translation("TailStore")
 * )
 */
class MiniCartBlock extends BlockBase implements ContainerFactoryPluginInterface {

  public function __construct(array $configuration, $plugin_id, $plugin_definition, private readonly CartServiceInterface $cart) {
    parent::__construct($configuration, $plugin_id, $plugin_definition);
  }

  public static function create(ContainerInterface $container, array $configuration, $plugin_id, $plugin_definition): self {
    return new self($configuration, $plugin_id, $plugin_definition, $container->get('tailstore_cart.cart'));
  }

  public function build(): array {
    $items = $this->cart->getItems();
    return [
      '#theme' => 'mini_cart',
      '#count' => $this->cart->getCount(),
      '#total' => $this->cart->getTotal(),
      '#items' => $items,
      '#attached' => ['library' => ['tailstore_cart/cart']],
    ];
  }
}
```

### Controller Panier (extrait)

```php
public function add(int $product_id, Request $request): Response {
  $qty = max(1, (int) $request->request->get('quantity', 1));
  $this->cart->add($product_id, $qty);
  $items = $this->cart->getItems();

  if ($request->headers->get('HX-Request')) {
    return $this->twigFragment('mini-cart', ['items' => $items, 'count' => $this->cart->getCount(), 'total' => $this->cart->getTotal()]);
  }

  $this->messenger()->addStatus($this->t('Product added to cart.'));
  return $this->redirect('tailstore_cart.cart_page');
}
```

Ces solutions assurent que les Ã©lÃ¨ves disposent de tout le code nÃ©cessaire pour obtenir le rendu Tailstore dans Drupal : thÃ¨me, bloc, contrÃ´leurs et routes.

## ğŸ“ Structure finale du module

```
modules/custom/tailstore_cart/
â”œâ”€â”€ tailstore_cart.info.yml
â”œâ”€â”€ tailstore_cart.module
â”œâ”€â”€ tailstore_cart.routing.yml
â”œâ”€â”€ tailstore_cart.services.yml
â”œâ”€â”€ tailstore_cart.permissions.yml
â”œâ”€â”€ tailstore_cart.libraries.yml
â”œâ”€â”€ tailstore_cart.links.menu.yml
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ install/
â”‚   â”‚   â””â”€â”€ tailstore_cart.settings.yml
â”‚   â””â”€â”€ schema/
â”‚       â””â”€â”€ tailstore_cart.schema.yml
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ Controller/
â”‚   â”‚   â”œâ”€â”€ CartController.php
â”‚   â”‚   â”œâ”€â”€ CheckoutController.php
â”‚   â”‚   â””â”€â”€ WebhookController.php
â”‚   â”œâ”€â”€ Service/
â”‚   â”‚   â”œâ”€â”€ CartServiceInterface.php
â”‚   â”‚   â”œâ”€â”€ CartService.php
â”‚   â”‚   â”œâ”€â”€ StripeServiceInterface.php
â”‚   â”‚   â””â”€â”€ StripeService.php
â”‚   â”œâ”€â”€ Form/
â”‚   â”‚   â””â”€â”€ SettingsForm.php
â”‚   â””â”€â”€ Plugin/
â”‚       â””â”€â”€ Block/
â”‚           â””â”€â”€ MiniCartBlock.php
â”œâ”€â”€ templates/
â”‚   â”œâ”€â”€ cart-page.html.twig
â”‚   â”œâ”€â”€ mini-cart.html.twig
â”‚   â”œâ”€â”€ checkout-success.html.twig
â”‚   â””â”€â”€ checkout-cancel.html.twig
â””â”€â”€ css/
    â””â”€â”€ cart.css
```

## ğŸ“‹ Export et commit

```bash
# Exporter la configuration
ddev drush cex -y

# Commit
git add .
git commit -m "feat: complete tailstore_cart module with htmx and Stripe"
```

## ğŸ“ FÃ©licitations !

Vous avez terminÃ© le Drupal Bootcamp ! Vous maÃ®trisez maintenant :

- âœ… L'installation et configuration de Drupal
- âœ… La crÃ©ation de contenus et taxonomies
- âœ… Les vues et la navigation
- âœ… Le theming avec Tailwind CSS
- âœ… Les modules contributifs essentiels
- âœ… Le dÃ©veloppement de modules custom
- âœ… L'intÃ©gration htmx et Stripe

## ğŸ”œ Pour aller plus loin

- [Projet IntÃ©grateur](/projet/) : Appliquez toutes vos connaissances
- [Ressources](/ressources/) : Documentation et liens utiles
