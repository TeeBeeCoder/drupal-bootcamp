---
title: Exercices √âtape 7
description: Mise en pratique des modules contributifs Drupal pour professionnaliser TailStore
sidebar:
  order: 6

# status: stable
# last-reviewed: 2026-01-14
---

import { Tabs, TabItem, Aside, Card, CardGrid, Steps } from '@astrojs/starlight/components';

## üéØ Objectifs

√Ä la fin de ces exercices, vous aurez :
- üì¶ Install√© et configur√© tous les modules essentiels pour un site e-commerce professionnel
- üîó Configur√© des URLs automatiques SEO-friendly pour tous les contenus
- üìä Optimis√© le r√©f√©rencement avec les m√©tadonn√©es sociales
- üìù Cr√©√© des formulaires fonctionnels avec protection anti-spam
- üöÄ Mis en place les outils pour un site maintenable et performant

<Aside type="note" title="Approche p√©dagogique">
Ces exercices suivent un workflow professionnel :
1. **Installation** et activation via Composer/Drush
2. **Configuration** adapt√©e au projet TailStore
3. **Test** pour valider le fonctionnement
4. **Export** de la configuration pour versionnement

C'est la m√©thode utilis√©e en entreprise.
</Aside>

<Aside type="tip" title="Temps de r√©alisation">
- **Exercice 1** : 20 min (Installation modules)
- **Exercice 2** : 25 min (Pathauto)
- **Exercice 3** : 30 min (Metatag)
- **Exercice 4** : 35 min (Webform contact)
- **Exercice 5** : 30 min (Webform devis)
- **Exercice 6** : 15 min (Sitemap)
- **Exercice 7** : 15 min (S√©curit√©)

**Total** : ~2h50
</Aside>

---

## Exercice 1 : Installation des modules

<Card title="Dur√©e estim√©e : 20 minutes" icon="clock">
  Installer et activer tous les modules contributifs n√©cessaires.
</Card>

### Objectif

Pr√©parer l'environnement TailStore avec tous les modules.

### Instructions

<Steps>

1. **Installer les modules avec Composer**

   ```bash
   ddev composer require \
     drupal/pathauto \
     drupal/token \
     drupal/metatag \
     drupal/webform \
     drupal/redirect \
     drupal/simple_sitemap \
     drupal/admin_toolbar \
     drupal/gin \
     drupal/honeypot
   ```

2. **Activer les modules**

   ```bash
   ddev drush en \
     pathauto token \
     metatag metatag_open_graph metatag_twitter_cards \
     webform webform_ui \
     redirect simple_sitemap \
     admin_toolbar admin_toolbar_tools \
     honeypot -y
   ```

3. **Configurer Gin comme th√®me admin**

   ```bash
   ddev drush theme:enable gin -y
   ddev drush config-set system.theme admin gin -y
   ```

4. **V√©rifier l'installation**

   ```bash
   ddev drush pm:list --status=enabled --format=table
   ```

</Steps>

### Validation ‚úì

- [ ] Tous les modules install√©s sans erreur (v√©rifier dans `composer.json`)
- [ ] Modules activ√©s (v√©rifier avec `drush pm:list --status=enabled`)
- [ ] Gin visible et fonctionnel dans l'administration
- [ ] Admin Toolbar avec menus d√©roulants op√©rationnels
- [ ] Aucune erreur dans les logs (`drush ws` pour watchdog)
- [ ] Configuration export√©e (`ddev drush cex -y`)
- [ ] Fichiers committ√©s (composer.json, composer.lock, config/)

<Aside type="caution" title="Erreurs courantes">
**Erreur** : `Your requirements could not be resolved...`

**Solution** : Conflit de versions. V√©rifier la compatibilit√© Drupal 11
```bash
ddev composer why-not drupal/module_name
```

**Erreur** : `Class not found...`

**Solution** : R√©g√©n√©rer l'autoloader
```bash
ddev composer dump-autoload
ddev drush cr
```

**Erreur** : `Module already enabled`

**Solution** : Normal, le module √©tait d√©j√† activ√©. Continuer.
</Aside>

### Points d'attention

üí° **Commit apr√®s installation** :
```bash
git add composer.json composer.lock config/
git commit -m "feat(modules): install contrib modules (pathauto, metatag, webform, admin_toolbar, gin, honeypot)"
```

üí° **D√©ploiement sur autre environnement** :
```bash
# Sur staging/production
composer install
drush cim -y
drush cr
```

---

## Exercice 2 : Configuration Pathauto

<Card title="Dur√©e estim√©e : 25 minutes" icon="clock">
  Configurer les URLs automatiques pour tous les contenus.
</Card>

### Objectif

Cr√©er des mod√®les d'URL propres pour chaque type.

### Instructions

<Steps>

1. **Acc√©der √† Pathauto**

   `/admin/config/search/path/patterns`

2. **Cr√©er le mod√®le Produits**

   - Type : Contenu ‚Üí Produit
   - Libell√© : Produits
   - Mod√®le : `boutique/[node:field_category:entity:name]/[node:title]`

3. **Cr√©er le mod√®le Articles**

   - Type : Contenu ‚Üí Article Blog
   - Libell√© : Articles Blog
   - Mod√®le : `blog/[node:created:custom:Y-m]/[node:title]`

4. **Cr√©er le mod√®le Cat√©gories**

   - Type : Terme de taxonomie ‚Üí Cat√©gorie
   - Libell√© : Cat√©gories
   - Mod√®le : `categories/[term:name]`

5. **Cr√©er le mod√®le Marques**

   - Type : Terme de taxonomie ‚Üí Marque
   - Libell√© : Marques
   - Mod√®le : `marques/[term:name]`

6. **Configurer les param√®tres g√©n√©raux**

   `/admin/config/search/path/settings`

   ```yaml
   S√©parateur: "-"
   Casse: Minuscules
   Longueur max: 100
   ```

7. **G√©n√©rer les alias existants**

   ```bash
   ddev drush pathauto:aliases-generate all
   ```

</Steps>

### Test

Cr√©ez un produit "Pantalon Cargo" dans la cat√©gorie "Pantalons".

**URL attendue** : `/boutique/pantalons/pantalon-cargo`

Cr√©ez un article de blog "Tendances mode hiver 2026" publi√© le 14 janvier 2026.

**URL attendue** : `/blog/2026-01/tendances-mode-hiver-2026`

<Aside type="tip" title="Tester la translitt√©ration">
Cr√©ez un produit avec caract√®res accentu√©s : "T-Shirt √©t√© √† fleurs"

**URL attendue** : `/boutique/t-shirts/t-shirt-ete-a-fleurs`

Les accents doivent √™tre automatiquement transform√©s.
</Aside>

### Validation ‚úì

- [ ] Mod√®le Produits cr√©√© et fonctionnel
- [ ] Mod√®le Articles cr√©√© avec date dans l'URL
- [ ] Mod√®le Cat√©gories cr√©√©
- [ ] Mod√®le Marques cr√©√©
- [ ] URLs g√©n√©r√©es correctement (v√©rifier 3-5 contenus)
- [ ] Translitt√©ration fonctionnelle (√© ‚Üí e, √† ‚Üí a, etc.)
- [ ] S√©parateur `-` appliqu√©
- [ ] Longueur max respect√©e (< 100 caract√®res)
- [ ] Alias existants r√©g√©n√©r√©s
- [ ] Configuration export√©e

### V√©rification technique

```bash
# Lister les alias g√©n√©r√©s
ddev drush sqlq "SELECT alias, path FROM path_alias LIMIT 10"

# V√©rifier un alias sp√©cifique
ddev drush path:alias /node/42

# Compter les alias par type
ddev drush sqlq "SELECT COUNT(*) FROM path_alias WHERE path LIKE '/node/%'"
```

<Aside type="caution" title="Probl√®me : Alias non g√©n√©r√©">
**V√©rifier** :
1. Le mod√®le existe pour ce type de contenu
2. La case "G√©n√©rer automatiquement" est coch√©e dans le formulaire
3. Le cache est vid√©

**Forcer la g√©n√©ration** :
```bash
ddev drush cr
ddev drush pathauto:aliases-generate all
```
</Aside>

---

## Exercice 3 : Configuration SEO

<Card title="Dur√©e estim√©e : 30 minutes" icon="clock">
  Optimiser les m√©tadonn√©es pour le r√©f√©rencement.
</Card>

### Objectif

Configurer Metatag pour les produits et le partage social.

### Instructions

<Steps>

1. **Configuration globale**

   `/admin/config/search/metatag`

   Modifier **Global** :

   ```yaml
   Titre: "[current-page:title] | TailStore"
   Description: "TailStore - Votre boutique de mode en ligne"
   ```

2. **Configuration Produit**

   Ajouter un mod√®le pour **Contenu: Produit** :

   **Basique :**
   ```yaml
   Titre: "[node:title] - [node:field_price:value]‚Ç¨ | TailStore"
   Description: "[node:field_description:summary]"
   ```

   **Open Graph :**
   ```yaml
   og:type: "product"
   og:title: "[node:title]"
   og:description: "[node:field_description:summary]"
   og:image: "[node:field_images:entity:url]"
   og:site_name: "TailStore"
   ```

   **Twitter Cards :**
   ```yaml
   twitter:card: "summary_large_image"
   twitter:title: "[node:title]"
   twitter:description: "[node:field_description:summary]"
   twitter:image: "[node:field_images:entity:url]"
   ```

3. **Configuration Article Blog**

   Ajouter un mod√®le pour **Contenu: Article Blog** :

   ```yaml
   og:type: "article"
   article:published_time: "[node:created:html_datetime]"
   article:author: "[node:author:display-name]"
   ```

4. **Cr√©er un style d'image Open Graph**

   `/admin/config/media/image-styles/add`

   - Nom : `opengraph`
   - Effet : Scale and crop (1200√ó630)

</Steps>

### Test

1. Visitez un produit
2. Affichez le code source
3. V√©rifiez les balises `<meta property="og:..."`

### Validation ‚úì

- [ ] M√©tadonn√©es globales configur√©es
- [ ] Open Graph pour les produits avec tous les champs
- [ ] Twitter Cards configur√©es
- [ ] Style d'image OG cr√©√© (1200√ó630px)
- [ ] Test avec [Facebook Debugger](https://developers.facebook.com/tools/debug/)
- [ ] Test avec [Twitter Card Validator](https://cards-dev.twitter.com/validator)
- [ ] Balises pr√©sentes dans le code source HTML
- [ ] Images correctement affich√©es dans les validateurs
- [ ] Configuration export√©e

### V√©rification dans le code source

1. Visitez une page produit
2. **Clic droit** ‚Üí **Afficher le code source**
3. Cherchez `<meta property="og:` (Ctrl+F)

**Attendu** :
```html
<meta property="og:type" content="product" />
<meta property="og:title" content="T-Shirt Blanc - 29.99‚Ç¨ | TailStore" />
<meta property="og:description" content="T-shirt en coton bio..." />
<meta property="og:image" content="https://tailstore.ddev.site/sites/default/files/2026-01/tshirt.jpg" />
<meta property="og:site_name" content="TailStore" />
<meta property="og:url" content="https://tailstore.ddev.site/boutique/t-shirts/t-shirt-blanc" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="T-Shirt Blanc - 29.99‚Ç¨ | TailStore" />
<meta name="twitter:description" content="T-shirt en coton bio..." />
<meta name="twitter:image" content="https://tailstore.ddev.site/sites/default/files/2026-01/tshirt.jpg" />
```

<Aside type="caution" title="Erreurs courantes">
**Image non affich√©e** :
- V√©rifier que l'image existe et est accessible publiquement
- V√©rifier le style d'image (doit √™tre 1200√ó630)
- URL absolue requise (pas de chemin relatif)

**Titre trop long** :
- Facebook tronque √† 60 caract√®res
- Adapter le mod√®le si n√©cessaire

**Description vide** :
- V√©rifier que le token pointe vers le bon champ
- V√©rifier que le contenu a bien une description
</Aside>

### Test partage social

**Facebook** :
1. Allez sur [Facebook Debugger](https://developers.facebook.com/tools/debug/)
2. Entrez l'URL de votre produit
3. Cliquez **D√©boguer**
4. V√©rifiez l'aper√ßu

**Twitter** :
1. Allez sur [Card Validator](https://cards-dev.twitter.com/validator)
2. Entrez l'URL
3. V√©rifiez la Card Preview

---

## Exercice 4 : Formulaire de contact

<Card title="Dur√©e estim√©e : 35 minutes" icon="clock">
  Cr√©er un formulaire de contact complet avec notifications.
</Card>

### Objectif

Cr√©er le formulaire de contact TailStore avec emails automatiques.

### Instructions

<Steps>

1. **Cr√©er le webform**

   `/admin/structure/webform/add`

   - Titre : Formulaire de contact
   - ID : `contact`

2. **Ajouter les √©l√©ments**

   | Ordre | Type | Cl√© | Libell√© | Requis |
   |-------|------|-----|---------|--------|
   | 1 | Fieldset | personal_info | Vos informations | - |
   | 2 | Text | name | Nom complet | ‚úÖ |
   | 3 | Email | email | Email | ‚úÖ |
   | 4 | Tel | phone | T√©l√©phone | ‚ùå |
   | 5 | Fieldset | message_info | Votre message | - |
   | 6 | Select | subject | Sujet | ‚úÖ |
   | 7 | Textarea | message | Message | ‚úÖ |

   **Options du sujet :**
   ```
   general|Question g√©n√©rale
   order|Suivi de commande
   return|Retour produit
   partnership|Partenariat
   other|Autre
   ```

3. **Configurer l'email admin**

   `/admin/structure/webform/manage/contact/handlers`

   Ajouter un **Email handler** :

   ```yaml
   Titre: Notification √©quipe
   Destinataire: contact@tailstore.com
   Sujet: "[TailStore] [webform_submission:values:subject] - [webform_submission:values:name]"
   Corps: |
     Un nouveau message a √©t√© re√ßu sur TailStore.
     
     === Exp√©diteur ===
     Nom: [webform_submission:values:name]
     Email: [webform_submission:values:email]
     T√©l√©phone: [webform_submission:values:phone]
     
     === Message ===
     Sujet: [webform_submission:values:subject]
     
     [webform_submission:values:message]
     
     ---
     R√©pondre directement √† cet email pour contacter le client.
   
   R√©pondre √†: [webform_submission:values:email]
   ```

4. **Configurer l'email confirmation**

   Ajouter un second **Email handler** :

   ```yaml
   Titre: Confirmation client
   Destinataire: [webform_submission:values:email]
   Sujet: "Votre message a bien √©t√© re√ßu - TailStore"
   Corps: |
     Bonjour [webform_submission:values:name],
     
     Nous avons bien re√ßu votre message concernant "[webform_submission:values:subject]".
     
     Notre √©quipe vous r√©pondra dans les 48 heures ouvr√©es.
     
     Cordialement,
     L'√©quipe TailStore
     
     ---
     Ceci est un message automatique, merci de ne pas y r√©pondre.
   ```

5. **Configurer le message de confirmation**

   `/admin/structure/webform/manage/contact/settings/confirmation`

   ```yaml
   Type: Page
   Titre: Merci pour votre message !
   Message: |
     Votre message a √©t√© envoy√© avec succ√®s.
     Nous vous r√©pondrons dans les plus brefs d√©lais.
   ```

6. **Ajouter le formulaire √† une page**

   Cr√©ez une page "Contact" et int√©grez le bloc Webform.

</Steps>

### Validation ‚úì

- [ ] Formulaire cr√©√© avec tous les champs obligatoires
- [ ] Email admin configur√© avec bon format
- [ ] Email confirmation client configur√©
- [ ] Message de confirmation affich√© apr√®s soumission
- [ ] Formulaire accessible sur /form/contact
- [ ] Formulaire int√©gr√© dans une page ou un bloc
- [ ] Test d'envoi fonctionnel (v√©rifier r√©ception email)
- [ ] Soumission enregistr√©e dans **R√©sultats**
- [ ] Champs requis valid√©s (erreur si vide)
- [ ] Format email valid√© automatiquement
- [ ] Configuration export√©e

### Test complet

<Steps>

1. **Acc√©der au formulaire**
   
   `/form/contact`

2. **Test validation**
   
   - Soumettez le formulaire vide ‚Üí Erreurs affich√©es ?
   - Email invalide : `test` ‚Üí Erreur format ?

3. **Test soumission valide**
   
   Remplissez tous les champs et soumettez

4. **V√©rifier l'email admin**
   
   ```bash
   # Voir les emails captur√©s par DDEV (mailpit)
   ddev launch -m
   ```
   
   Ou acc√©dez √† : `https://tailstore.ddev.site:8026`

5. **V√©rifier la soumission**
   
   `/admin/structure/webform/manage/contact/results/submissions`

</Steps>

<Aside type="tip" title="D√©boguer les emails">
**Email non re√ßu ?**

1. V√©rifier Mailpit (interface DDEV) : `ddev launch -m`
2. V√©rifier les logs Webform : **Rapports** ‚Üí **Journaux r√©cents**
3. V√©rifier la configuration email : **Configuration** ‚Üí **Syst√®me** ‚Üí **Configuration de base du site**

**Tester l'envoi** :
```bash
# Envoyer un email de test
ddev drush php-eval "mail('test@example.com', 'Test', 'Corps du message');"
```
</Aside>

### Personnalisation avanc√©e

Ajoutez des classes CSS TailStore :

```yaml
# Sur chaque champ
wrapper_attributes:
  class: 'mb-4'

attributes:
  class: 'w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500'

# Sur le bouton submit
attributes:
  class: 'btn btn-primary w-full md:w-auto'
```

---

## Exercice 5 : Formulaire demande de devis

<Card title="Dur√©e estim√©e : 30 minutes" icon="clock">
  Cr√©er un formulaire multi-√©tapes pour les demandes de devis.
</Card>

### Objectif

Cr√©er un formulaire plus complexe avec wizard et champs conditionnels.

### Instructions

<Steps>

1. **Cr√©er le webform**

   - Titre : Demande de devis
   - ID : `quote_request`

2. **Page 1 : Informations**

   ```yaml
   wizard_page_1:
     type: wizard_page
     title: "Vos informations"
   
   name:
     type: textfield
     title: "Nom complet"
     required: true
   
   email:
     type: email
     title: "Email"
     required: true
   
   company:
     type: textfield
     title: "Entreprise"
   
   phone:
     type: tel
     title: "T√©l√©phone"
     required: true
   ```

3. **Page 2 : Produits**

   ```yaml
   wizard_page_2:
     type: wizard_page
     title: "Produits souhait√©s"
   
   products:
     type: checkboxes
     title: "Cat√©gories de produits"
     options:
       clothing: "V√™tements"
       shoes: "Chaussures"
       accessories: "Accessoires"
   
   quantity:
     type: select
     title: "Quantit√© estim√©e"
     options:
       10_50: "10 √† 50 pi√®ces"
       50_100: "50 √† 100 pi√®ces"
       100_500: "100 √† 500 pi√®ces"
       500_plus: "Plus de 500 pi√®ces"
   
   details:
     type: textarea
     title: "Description des besoins"
   ```

4. **Page 3 : Budget et d√©lai**

   ```yaml
   wizard_page_3:
     type: wizard_page
     title: "Budget et planning"
   
   budget:
     type: radios
     title: "Budget estim√©"
     options:
       small: "Moins de 1 000‚Ç¨"
       medium: "1 000‚Ç¨ - 5 000‚Ç¨"
       large: "5 000‚Ç¨ - 20 000‚Ç¨"
       enterprise: "Plus de 20 000‚Ç¨"
   
   deadline:
     type: date
     title: "Date souhait√©e de livraison"
   
   urgency:
     type: radios
     title: "Niveau d'urgence"
     options:
       low: "Faible - Plusieurs mois"
       medium: "Moyen - 1 √† 2 mois"
       high: "√âlev√© - Moins d'un mois"
   ```

5. **Configurer la progression**

   - Afficher la barre de progression
   - Permettre le retour arri√®re

6. **Configurer les emails**

   Cr√©er des emails personnalis√©s avec toutes les infos.

</Steps>

### Validation ‚úì

- [ ] Wizard √† 3 √©tapes cr√©√©
- [ ] Navigation avant/arri√®re fonctionnelle
- [ ] Barre de progression affich√©e
- [ ] Tous les champs fonctionnels et bien label√©s
- [ ] Email r√©capitulatif complet avec toutes les infos
- [ ] Test du parcours complet sans erreur
- [ ] Donn√©es correctement enregistr√©es dans les r√©sultats
- [ ] Email re√ßu avec mise en forme lisible
- [ ] Configuration export√©e

<Aside type="tip" title="Bonnes pratiques UX pour les wizards">
**Progression visible** :
- ‚úÖ Afficher l'√©tape actuelle : "Etape 1/3"
- ‚úÖ Nommer clairement chaque √©tape
- ‚úÖ Permettre le retour arri√®re sans perte de donn√©es

**Navigation** :
- ‚úÖ Bouton "Pr√©c√©dent" toujours visible (sauf √©tape 1)
- ‚úÖ Bouton "Suivant" avec texte clair
- ‚úÖ Derni√®re √©tape : "Envoyer ma demande de devis"

**Validation** :
- ‚úÖ Valider chaque √©tape avant de passer √† la suivante
- ‚úÖ Afficher les erreurs clairement
- ‚úÖ Ne pas perdre les donn√©es en cas d'erreur
</Aside>

### Email r√©capitulatif complet

Exemple de configuration email :

```yaml
Titre: Demande de devis
Destinataire: devis@tailstore.com
Sujet: "[TailStore] Nouvelle demande de devis - [webform_submission:values:company]"
Corps: |
  === NOUVELLE DEMANDE DE DEVIS ===
  
  Date: [webform_submission:created:custom:d/m/Y √† H:i]
  
  --- Informations client ---
  Nom: [webform_submission:values:name]
  Email: [webform_submission:values:email]
  T√©l√©phone: [webform_submission:values:phone]
  Entreprise: [webform_submission:values:company]
  
  --- Produits demand√©s ---
  Cat√©gories: [webform_submission:values:products]
  Quantit√©: [webform_submission:values:quantity]
  D√©tails: [webform_submission:values:details]
  
  --- Budget et planning ---
  Budget estim√©: [webform_submission:values:budget]
  Date souhait√©e: [webform_submission:values:deadline:custom:d/m/Y]
  Urgence: [webform_submission:values:urgency]
  
  ---
  Voir la soumission compl√®te :
  [webform_submission:url]
```

### Test du workflow complet

1. **√âtape 1** : Remplir les infos personnelles ‚Üí Suivant
2. **√âtape 2** : S√©lectionner produits et quantit√©s ‚Üí Suivant
3. **√âtape 3** : Budget et d√©lai ‚Üí Envoyer
4. **V√©rifier** : Page de confirmation + email re√ßu

---

## Exercice 6 : Sitemap XML

<Card title="Dur√©e estim√©e : 15 minutes" icon="clock">
  G√©n√©rer un sitemap pour les moteurs de recherche.
</Card>

### Objectif

Configurer Simple Sitemap pour indexer tous les contenus.

### Instructions

<Steps>

1. **Configuration du sitemap**

   `/admin/config/search/simplesitemap`

2. **Activer les types de contenu**

   Pour chaque entit√©, configurer :

   | Type | Indexer | Priorit√© |
   |------|---------|----------|
   | Produit | ‚úÖ | 0.8 |
   | Article Blog | ‚úÖ | 0.6 |
   | Page | ‚úÖ | 0.5 |
   | Cat√©gorie | ‚úÖ | 0.7 |
   | Marque | ‚úÖ | 0.6 |

3. **G√©n√©rer le sitemap**

   ```bash
   ddev drush simple-sitemap:generate
   ```

4. **V√©rifier**

   Acc√©dez √† `/sitemap.xml`

5. **Soumettre √† Google**

   Dans Google Search Console, soumettez l'URL du sitemap.

</Steps>

### Validation ‚úì

- [ ] Tous les types configur√©s dans Simple Sitemap
- [ ] Priorit√©s d√©finies selon l'importance
- [ ] Sitemap accessible √† /sitemap.xml
- [ ] URLs propres (Pathauto) dans le sitemap
- [ ] Contenu test pr√©sent dans le sitemap
- [ ] Fichier XML valide (pas d'erreur de syntaxe)
- [ ] Sitemaps soumis √† Google Search Console (optionnel)
- [ ] Configuration export√©e

### V√©rification du sitemap

```bash
# G√©n√©rer le sitemap
ddev drush simple-sitemap:generate

# Voir le contenu
curl https://tailstore.ddev.site/sitemap.xml

# Ou dans le navigateur
```

**Exemple de sortie attendue** :
```xml
<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
  <url>
    <loc>https://tailstore.ddev.site/</loc>
    <priority>1.0</priority>
  </url>
  <url>
    <loc>https://tailstore.ddev.site/boutique/t-shirts/t-shirt-blanc</loc>
    <priority>0.8</priority>
  </url>
  <url>
    <loc>https://tailstore.ddev.site/blog/2026-01/tendances-mode-hiver</loc>
    <priority>0.6</priority>
  </url>
</urlset>
```

<Aside type="tip" title="Bonnes pratiques Sitemap">
**Priorit√©s recommand√©es** :
- Page d'accueil : 1.0
- Pages produits : 0.8-0.9 (contenu principal e-commerce)
- Cat√©gories : 0.7
- Articles blog : 0.5-0.6
- Pages statiques : 0.5

**Fr√©quence de mise √† jour** :
- Automatique lors de cr√©ation/modification de contenu
- Ou via cron : `drush simple-sitemap:generate`

**Soumettre √† Google** :
1. Google Search Console ‚Üí Sitemaps
2. Ajouter URL : `https://tailstore.com/sitemap.xml`
3. V√©rifier l'indexation apr√®s quelques jours
</Aside>

### Configuration avanc√©e

**Exclure certains contenus** :
```yaml
# Configuration ‚Üí Simple Sitemap ‚Üí Entit√©s
# Pour chaque type, d√©finir :
Inclure: Oui/Non
Priorit√©: 0.1 - 1.0
Changefreq: daily, weekly, monthly, yearly
```

**Multi-sitemap** (pour gros sites) :
Simple Sitemap g√©n√®re automatiquement plusieurs sitemaps si > 50 000 URLs

---

## Exercice 7 : S√©curit√© anti-spam

<Card title="Dur√©e estim√©e : 15 minutes" icon="clock">
  Prot√©ger les formulaires contre le spam.
</Card>

### Objectif

Configurer Honeypot et limiter les soumissions.

### Instructions

<Steps>

1. **V√©rifier Honeypot**

   `/admin/config/content/honeypot`

   ```yaml
   Prot√©ger tous les formulaires: Oui
   D√©lai minimum: 5 secondes
   ```

2. **Limiter les soumissions Webform**

   Pour chaque formulaire :

   `/admin/structure/webform/manage/[id]/settings/submissions`

   ```yaml
   Limite par utilisateur: 3 par jour
   Limite totale: 50 par jour
   Message: "Vous avez atteint la limite..."
   ```

3. **Tester**

   Essayez de soumettre trop rapidement (< 5 secondes).

</Steps>

### Validation ‚úì

- [ ] Honeypot activ√© sur tous les formulaires
- [ ] D√©lai minimum configur√© (5 secondes)
- [ ] Limites de soumission d√©finies par formulaire
- [ ] Message d'erreur clair pour l'utilisateur
- [ ] Test : soumission trop rapide bloqu√©e
- [ ] Test : limite de soumissions respect√©e
- [ ] Configuration export√©e

### Test Honeypot

<Steps>

1. **Acc√©der au formulaire** : `/form/contact`

2. **Ouvrir les outils d√©veloppeur** (F12)

3. **Inspecter le formulaire**
   
   Chercher un champ cach√© (probablement `<input name="url" type="text" style="display:none">`)

4. **Tester la soumission rapide**
   
   Remplir et soumettre en < 5 secondes ‚Üí **Refus attendu**

5. **Tester apr√®s d√©lai**
   
   Attendre > 5 secondes puis soumettre ‚Üí **Succ√®s attendu**

</Steps>

### Test limites de soumissions

```bash
# Simuler plusieurs soumissions
ddev drush webform:test contact --num=4

# La 4√®me devrait √™tre refus√©e si limite = 3
```

Ou testez manuellement en soumettant le formulaire 4 fois.

<Aside type="tip" title="Strat√©gie anti-spam compl√®te">
**Niveau 1 : Honeypot** (recommand√© pour tous)
- Invisible pour l'utilisateur
- Bloque 90% des bots
- Sans impact sur l'UX

**Niveau 2 : Limites de soumission**
- Emp√™che les abus
- L√©g√®re contrainte pour utilisateurs l√©gitimes

**Niveau 3 : CAPTCHA** (seulement si n√©cessaire)
- R√©duire le taux de conversion de 10-30%
- √Ä utiliser uniquement en cas de spam massif
- Pr√©f√©rer reCAPTCHA v3 (invisible)

**Niveau 4 : Validation email**
- Email de confirmation avec lien √† cliquer
- Pour les inscriptions/cr√©ations de compte
</Aside>

### Monitoring

**Surveiller les tentatives de spam** :

```bash
# Voir les soumissions r√©centes
ddev drush sqlq "SELECT * FROM webform_submission ORDER BY created DESC LIMIT 10"

# Logs Honeypot
# Rapports ‚Üí Journaux r√©cents ‚Üí Filtrer "honeypot"
```

**Ajuster les param√®tres** si n√©cessaire :
- Augmenter le d√©lai minimum (10-15 secondes)
- R√©duire les limites de soumission
- Ajouter CAPTCHA en cas de spam persistant

---

## üèÜ R√©capitulatif √âtape 7

<CardGrid>
  <Card title="Modules install√©s" icon="puzzle">
    ‚úÖ 9 modules contributifs
    ‚úÖ Configuration compl√®te
    ‚úÖ Tests valid√©s
  </Card>
  <Card title="URLs propres" icon="document">
    ‚úÖ Pathauto configur√©
    ‚úÖ Mod√®les pour tous types
    ‚úÖ Translitt√©ration active
  </Card>
  <Card title="SEO optimis√©" icon="magnifier">
    ‚úÖ Metatag complet
    ‚úÖ Open Graph + Twitter
    ‚úÖ Sitemap XML g√©n√©r√©
  </Card>
  <Card title="Formulaires" icon="pencil">
    ‚úÖ Contact fonctionnel
    ‚úÖ Devis multi-√©tapes
    ‚úÖ Anti-spam actif
  </Card>
</CardGrid>

## üìã Checklist finale compl√®te

### Infrastructure
- [ ] Tous les modules install√©s via Composer
- [ ] Modules activ√©s via Drush
- [ ] Gin theme admin activ√©
- [ ] Admin Toolbar op√©rationnel

### URLs et Navigation
- [ ] Pathauto : mod√®les cr√©√©s pour tous les types
- [ ] Token install√© et fonctionnel
- [ ] Redirect install√© pour les anciennes URLs
- [ ] Alias g√©n√©r√©s pour contenus existants

### SEO et M√©tadonn√©es
- [ ] Metatag : configuration globale
- [ ] Metatag : configuration par type de contenu
- [ ] Open Graph configur√© (Facebook, LinkedIn)
- [ ] Twitter Cards configur√©
- [ ] Images OG au bon format (1200√ó630)
- [ ] Test√© avec validateurs sociaux
- [ ] Simple Sitemap g√©n√©r√© (/sitemap.xml)

### Formulaires
- [ ] Webform install√© et activ√©
- [ ] Formulaire contact cr√©√© et test√©
- [ ] Formulaire devis (wizard) cr√©√©
- [ ] Emails admin configur√©s
- [ ] Emails confirmation client configur√©s
- [ ] Honeypot activ√©
- [ ] Limites de soumission d√©finies

### S√©curit√© et Protection
- [ ] Honeypot sur tous les formulaires
- [ ] D√©lai anti-spam configur√© (5+ secondes)
- [ ] Limites de soumission par utilisateur
- [ ] Messages d'erreur clairs

### Versionnement et D√©ploiement
- [ ] Configuration export√©e (`drush cex -y`)
- [ ] composer.json et composer.lock √† jour
- [ ] Fichiers de config dans `config/sync/`
- [ ] Tout committ√© dans Git

## üì¶ Export final

```bash
# Exporter toute la configuration
ddev drush cex -y

# V√©rifier les fichiers export√©s
ls -la config/sync/ | grep -E "(pathauto|metatag|webform)"

# Commit
git add composer.json composer.lock config/
git commit -m "feat(step7): configure contrib modules (pathauto, metatag, webform, sitemap, security)

- URLs automatiques avec Pathauto pour tous les types de contenu
- SEO optimis√© avec Metatag, Open Graph, Twitter Cards
- Formulaires contact et devis avec Webform
- Sitemap XML pour moteurs de recherche
- S√©curit√© anti-spam avec Honeypot
- Interface admin am√©lior√©e avec Gin et Admin Toolbar"

git push origin main
```

<Aside type="tip" title="D√©ploiement sur staging/production">
Pour d√©ployer sur un autre environnement :

```bash
# Tirer les derni√®res modifications
git pull origin main

# Installer les d√©pendances
composer install

# Importer la configuration
drush cim -y

# Vider le cache
drush cr

# G√©n√©rer le sitemap
drush simple-sitemap:generate
```

Cette proc√©dure garantit que tous les environnements sont identiques.
</Aside>

## üìä Impact sur TailStore

### Am√©liorations SEO
- **URLs lisibles** : `/boutique/t-shirts/t-shirt-blanc` au lieu de `/node/42`
- **Partage social optimis√©** : Beaux aper√ßus sur Facebook, Twitter, LinkedIn
- **Indexation am√©lior√©e** : Sitemap XML pour Google
- **Redirections** : Pas de liens cass√©s

### Exp√©rience utilisateur
- **Formulaires professionnels** : Contact, devis, newsletter
- **Interface admin moderne** : Gin + Admin Toolbar = gain de productivit√©
- **Performance** : Configuration optimis√©e

### Professionnalisation
- **Maintenabilit√©** : Configuration versionn√©e
- **S√©curit√©** : Protection anti-spam
- **Scalabilit√©** : Modules √©prouv√©s par la communaut√©

## üîú Prochaine √©tape

Les modules sont configur√©s ! Dans l'[√âtape 8](/etape-8-developpement/), nous d√©velopperons nos propres modules custom pour les fonctionnalit√©s sp√©cifiques √† TailStore.
